@model SelectSeatViewModel
@{
    ViewData["Title"] = "Ch·ªçn Gh·∫ø";
    Layout = "_Layout";
}

<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
        color: white;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        min-height: 100vh;
    }

    .main-container {
        display: grid;
        grid-template-columns: 1fr 400px;
        gap: 2rem;
        padding: 2rem;
        max-width: 1400px;
        margin: 0 auto;
        min-height: 100vh;
    }

    .movie-section {
        display: flex;
        flex-direction: column;
        gap: 2rem;
    }

    .movie-info-card {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 20px;
        padding: 2rem;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        gap: 2rem;
        align-items: flex-start;
    }

    .movie-poster {
        flex-shrink: 0;
        width: 200px;
        height: 300px;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 300"><defs><radialGradient id="bg" cx="50%" cy="30%"><stop offset="0%" stop-color="%23003366"/><stop offset="100%" stop-color="%23001122"/></radialGradient></defs><rect width="100%" height="100%" fill="url(%23bg)"/><circle cx="100" cy="100" r="50" fill="rgba(255,255,255,0.1)"/><text x="100" y="120" text-anchor="middle" fill="white" font-size="16" font-family="Arial">AVATAR</text><text x="100" y="140" text-anchor="middle" fill="white" font-size="8" font-family="Arial">THE WAY OF WATER</text><text x="100" y="280" text-anchor="middle" fill="white" font-size="8" font-family="Arial">DECEMBER</text></svg>') center/cover;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
    }

        .movie-poster img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

    .movie-details {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .movie-title {
        font-size: 2.5rem;
        font-weight: bold;
        margin-bottom: 0.5rem;
        background: linear-gradient(45deg, #fff, #87ceeb);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .movie-meta {
        display: flex;
        gap: 1rem;
        margin-bottom: 1rem;
        flex-wrap: wrap;
    }

    .meta-item {
        background: rgba(255, 255, 255, 0.1);
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-size: 0.9rem;
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .movie-description {
        color: rgba(255, 255, 255, 0.8);
        line-height: 1.6;
        font-size: 1rem;
        margin-bottom: 1rem;
    }

    .showtime-info {
        background: linear-gradient(45deg, #667eea, #764ba2);
        padding: 1.5rem;
        border-radius: 15px;
        margin-top: 1rem;
    }

    .showtime-details {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 1rem;
        text-align: center;
    }

    .showtime-item {
        background: rgba(255, 255, 255, 0.1);
        padding: 1rem;
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .showtime-label {
        font-size: 0.9rem;
        color: rgba(255, 255, 255, 0.8);
        margin-bottom: 0.5rem;
    }

    .showtime-value {
        font-size: 1.1rem;
        font-weight: bold;
        color: white;
    }

    /* CSS c·∫£i ti·∫øn cho ph·∫ßn ch·ªçn gh·∫ø */
    .seat-selection {
        flex: 1;
        padding: 2rem;
        background: rgba(255, 255, 255, 0.02);
        border-radius: 20px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .selection-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .section-title {
        font-size: 1.8rem;
        font-weight: 600;
        color: white;
        margin: 0;
    }

    .seat-info {
        display: flex;
        align-items: center;
        gap: 1rem;
        flex-wrap: wrap;
    }

    .seat-count, .seat-available, .seat-occupied {
        color: rgba(255, 255, 255, 0.8);
        font-size: 0.9rem;
        background: rgba(255, 255, 255, 0.1);
        padding: 0.3rem 0.8rem;
        border-radius: 15px;
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .seat-available {
        background: rgba(0, 255, 0, 0.2);
        border-color: rgba(0, 255, 0, 0.3);
    }

    .seat-occupied {
        background: rgba(255, 0, 0, 0.2);
        border-color: rgba(255, 0, 0, 0.3);
    }

    .seat-types {
        display: flex;
        gap: 0.5rem;
    }

    .seat-type {
        background: rgba(255, 255, 255, 0.1);
        padding: 0.3rem 0.8rem;
        border-radius: 15px;
        font-size: 0.8rem;
        color: white;
    }

    /* M√†n h√¨nh cong c·∫£i ti·∫øn */
    .screen-container {
        display: flex;
        justify-content: center;
        margin: 2rem 0 3rem 0;
        perspective: 1000px;
    }

    .screen {
        width: 80%;
        height: 8px;
        background: linear-gradient(90deg, transparent 0%, rgba(135, 206, 250, 0.8) 20%, rgba(135, 206, 250, 1) 50%, rgba(135, 206, 250, 0.8) 80%, transparent 100%);
        border-radius: 50px;
        position: relative;
        transform: rotateX(45deg) rotateY(0deg);
        box-shadow: 0 0 20px rgba(135, 206, 250, 0.5), 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    .screen-text {
        position: absolute;
        top: -25px;
        left: 50%;
        transform: translateX(-50%);
        color: rgba(255, 255, 255, 0.6);
        font-size: 0.8rem;
        letter-spacing: 2px;
        font-weight: 300;
    }

    /* C·∫£i ti·∫øn seat map */
    .seat-map {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.8rem;
        margin-bottom: 2rem;
        padding: 2rem;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 15px;
        border: 1px solid rgba(255, 255, 255, 0.05);
        min-height: 300px;
        width: 100%;
        overflow-x: auto;
    }

    .seat-row {
        display: flex;
        align-items: center;
        gap: 1rem;
        width: 100%;
        justify-content: center;
        min-height: 40px;
    }

    .row-label {
        color: rgba(255, 255, 255, 0.6);
        font-weight: 600;
        font-size: 0.9rem;
        width: 20px;
        text-align: center;
    }

    .seats-container {
        display: flex;
        gap: 0.5rem;
        align-items: center;
        flex-wrap: nowrap;
    }

    /* C·∫£i ti·∫øn style gh·∫ø */
    .seat {
        width: 35px;
        height: 35px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.75rem;
        font-weight: 600;
        color: white;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        flex-shrink: 0;
    }

    .seat-number {
        font-size: 0.7rem;
        font-weight: bold;
        text-align: center;
        line-height: 1;
    }

    .seat.regular.available {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.3);
    }

        .seat.regular.available:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.3);
        }

    .seat.vip.available {
        background: linear-gradient(45deg, #f5c518, #ffd700);
        border: 1px solid #ffd700;
        color: #000;
    }

        .seat.vip.available:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(245, 197, 24, 0.5);
        }

    .seat.selected {
        background: linear-gradient(45deg, #667eea, #764ba2) !important;
        border: 1px solid #764ba2 !important;
        color: white !important;
        transform: scale(1.1);
        box-shadow: 0 0 20px rgba(102, 126, 234, 0.6);
    }

    .seat.occupied {
        background: #666 !important;
        border: 1px solid #555 !important;
        cursor: not-allowed;
        opacity: 0.5;
    }

    /* Legend c·∫£i ti·∫øn */
    .seat-legend {
        display: flex;
        justify-content: center;
        gap: 1.5rem;
        flex-wrap: wrap;
        padding: 1rem;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .legend-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.8rem;
        color: rgba(255, 255, 255, 0.8);
    }

    .legend-seat {
        width: 16px;
        height: 16px;
        border-radius: 4px;
        border: 1px solid rgba(255, 255, 255, 0.3);
    }

        .legend-seat.normal {
            background: rgba(255, 255, 255, 0.1);
        }

        .legend-seat.comfort {
            background: rgba(255, 255, 255, 0.2);
        }

        .legend-seat.double-comfort {
            background: linear-gradient(45deg, #f5c518, #ffd700);
        }

        .legend-seat.available {
            background: rgba(255, 255, 255, 0.1);
        }

        .legend-seat.for-disabilities {
            background: rgba(0, 150, 255, 0.6);
        }

        .legend-seat.selected {
            background: linear-gradient(45deg, #667eea, #764ba2);
        }

        .legend-seat.taken {
            background: #666;
        }

    /* Booking section c·∫£i ti·∫øn */
    .booking-section {
        width: 350px;
        padding: 1rem;
    }

    .movie-tickets-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 20px;
        padding: 1.5rem;
        color: white;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }

        .card-header h3 {
            margin: 0;
            font-size: 1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

    .ticket-icon {
        font-size: 1.5rem;
    }

    .ticket-details {
        margin-bottom: 1.5rem;
    }

    .detail-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 0.8rem;
        font-size: 0.9rem;
    }

    .label {
        color: rgba(255, 255, 255, 0.8);
    }

    .value {
        font-weight: 600;
    }

    .total-amount {
        font-size: 1.1rem;
        font-weight: 700;
    }

    .selected-seats-display {
        margin: 1.5rem 0;
        padding: 1rem;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        min-height: 60px;
    }

    .seats-grid {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
        justify-content: center;
    }

    .ticket-summary {
        margin: 1.5rem 0;
        padding: 1rem;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
    }

    .summary-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 1rem;
        font-size: 0.9rem;
    }

    .total-price-section {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-weight: 700;
        font-size: 1.1rem;
        padding-top: 1rem;
        border-top: 1px solid rgba(255, 255, 255, 0.2);
    }

    .btn-buy {
        width: 100%;
        padding: 1rem;
        background: rgba(0, 0, 0, 0.8);
        border: none;
        border-radius: 10px;
        color: white;
        font-weight: 700;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
    }

        .btn-buy:hover:not(:disabled) {
            background: rgba(0, 0, 0, 0.9);
            transform: translateY(-2px);
        }

        .btn-buy:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

    
    @@media (max-width: 768px) {
        .main-container {
            flex-direction: column;
        }

        .booking-section {
            width: 100%;
            margin-top: 2rem;
        }

        .seat {
            width: 30px;
            height: 30px;
            font-size: 0.7rem;
        }

        .seat-legend {
            gap: 1rem;
        }
    }

    .btn {
        padding: 0.8rem 1.5rem;
        border: none;
        border-radius: 25px;
        cursor: pointer;
        transition: all 0.3s;
        font-weight: 500;
        font-size: 1rem;
        width: 100%;
        margin-bottom: 1rem;
    }

    .btn-primary {
        background: linear-gradient(45deg, #28a745, #20c997);
        color: white;
        border: 1px solid transparent;
    }

    .btn-secondary {
        background: rgba(255, 255, 255, 0.1);
        color: white;
        border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .btn:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    .btn:disabled {
        background: rgba(255, 255, 255, 0.1) !important;
        color: rgba(255, 255, 255, 0.3) !important;
        cursor: not-allowed;
        transform: none !important;
    }

    .btn-primary:hover:not(:disabled) {
        box-shadow: 0 10px 20px rgba(40, 167, 69, 0.3);
    }

    /* Thay th·∫ø CSS cho n√∫t thanh to√°n */
    .btn-continue {
        width: 100%;
        padding: 1.2rem;
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 50%, #ff3838 100%);
        color: white;
        border: none;
        border-radius: 15px;
        font-size: 1.2rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.4s ease;
        position: relative;
        overflow: hidden;
        text-transform: uppercase;
        letter-spacing: 1px;
        box-shadow: 0 8px 25px rgba(255, 107, 107, 0.3);
    }

    .btn-continue::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        transition: left 0.5s;
    }

    .btn-continue:hover::before {
        left: 100%;
    }

    .btn-continue:hover:not(:disabled) {
        transform: translateY(-3px) scale(1.02);
        box-shadow: 0 15px 35px rgba(255, 107, 107, 0.4);
        background: linear-gradient(135deg, #ff5252 0%, #d32f2f 50%, #c62828 100%);
    }

    .btn-continue:active {
        transform: translateY(-1px) scale(1.01);
        box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
    }

    .btn-continue:disabled {
        background: rgba(255, 255, 255, 0.1);
        cursor: not-allowed;
        opacity: 0.6;
        transform: none !important;
        box-shadow: none;
    }

    /* Hi·ªáu ·ª©ng loading cho n√∫t thanh to√°n */
    .btn-continue.loading {
        pointer-events: none;
        position: relative;
    }

    .btn-continue.loading::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 20px;
        height: 20px;
        margin: -10px 0 0 -10px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: white;
        animation: spin 1s linear infinite;
    }

    /* C·∫£i thi·ªán th√™m cho n√∫t x√°c nh·∫≠n gh·∫ø */
    .btn-confirm-seats {
        width: 100%;
        padding: 1.2rem;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #5a67d8 100%);
        color: white;
        border: none;
        border-radius: 15px;
        font-size: 1.1rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.4s ease;
        margin-bottom: 1rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        position: relative;
        overflow: hidden;
    }

    .btn-confirm-seats::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        transition: left 0.5s;
    }

    .btn-confirm-seats:hover::before {
        left: 100%;
    }

    .btn-confirm-seats:hover:not(:disabled) {
        transform: translateY(-3px) scale(1.02);
        box-shadow: 0 15px 35px rgba(102, 126, 234, 0.4);
        background: linear-gradient(135deg, #5a67d8 0%, #667eea 50%, #4c51bf 100%);
    }

    .btn-confirm-seats:active {
        transform: translateY(-1px) scale(1.01);
    }

    .btn-confirm-seats:disabled {
        background: rgba(255, 255, 255, 0.1);
        cursor: not-allowed;
        opacity: 0.6;
        transform: none !important;
        box-shadow: none;
    }

    /* C·∫£i thi·ªán container cho c√°c n√∫t */
    .ticket-actions {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        margin-top: 1.5rem;
    }

    /* Th√™m hi·ªáu ·ª©ng pulse cho n√∫t khi c√≥ th·ªÉ nh·∫•n */
    .btn-continue:not(:disabled),
    .btn-confirm-seats:not(:disabled) {
        animation: subtle-pulse 2s infinite;
    }

    @@keyframes subtle-pulse {
        0%, 100% {
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.3);
        }
        50% {
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.5);
        }
    }

    .btn-confirm-seats:not(:disabled) {
        animation: subtle-pulse-blue 2s infinite;
    }

    @@keyframes subtle-pulse-blue {
        0%, 100% {
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }
        50% {
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);
        }
    }

    .seat.loading {
        opacity: 0.6;
        pointer-events: none;
        position: relative;
    }

    .seat.loading::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 16px;
        height: 16px;
        margin: -8px 0 0 -8px;
        border: 2px solid #fff;
        border-radius: 50%;
        border-top-color: transparent;
        animation: spin 1s linear infinite;
    }

    @@keyframes spin {
        to { transform: rotate(360deg); }
    }

    @@media (max-width: 1024px) {
        .main-container {
            grid-template-columns: 1fr;
        }

        .movie-info-card {
            flex-direction: column;
            text-align: center;
        }

        .movie-poster {
            width: 150px;
            height: 225px;
            margin: 0 auto;
        }

        .seat {
            width: 25px;
            height: 25px;
            font-size: 0.6rem;
        }

        .movie-title {
            font-size: 1.8rem;
        }

        .booking-section {
            position: relative;
            top: 0;
        }
    }
</style>

<div class="main-container">
    <!-- Ph·∫ßn th√¥ng tin phim v√† ch·ªçn gh·∫ø -->
    <div class="movie-section">
        <!-- Th√¥ng tin phim -->
        <div class="movie-info-card">
            <div class="movie-poster">
                <div class="movie-poster">
                    <h1 class="movie-title">@Model.MovieTitle</h1>
                </div>
            </div>

            <div class="movie-details">
                <h1 class="movie-title">@Model.MovieTitle</h1>

                <div class="movie-meta" id="movieMeta">
                    <span class="meta-item">üìΩÔ∏è ƒêang t·∫£i...</span>
                    <span class="meta-item">‚è±Ô∏è ƒêang t·∫£i...</span>
                    <span class="meta-item">‚≠ê ƒêang t·∫£i...</span>
                    <span class="meta-item">üé¨ ƒêang t·∫£i...</span>
                </div>

                <div class="movie-description" id="movieDescription">
                    ƒêang t·∫£i th√¥ng tin phim...
                </div>

                <!-- Th√¥ng tin su·∫•t chi·∫øu -->
                <div class="showtime-info">
                    <div class="showtime-details">
                        <div class="showtime-item">
                            <div class="showtime-label">üé≠ R·∫°p chi·∫øu</div>
                            <div class="showtime-value" id="cinemaRoom">@Model.CinemaRoom</div>
                        </div>
                        <div class="showtime-item">
                            <div class="showtime-label">üìÖ Ng√†y chi·∫øu</div>
                            <div class="showtime-value" id="showDate">@Model.ShowTime.ToString("dd/MM/yyyy")</div>
                        </div>
                        <div class="showtime-item">
                            <div class="showtime-label">üïê Gi·ªù chi·∫øu</div>
                            <div class="showtime-value" id="showTime">@Model.ShowTime.ToString("HH:mm")</div>
                        </div>
                        <div class="showtime-item">
                            <div class="showtime-label">üé´ Lo·∫°i v√©</div>
                            <div class="showtime-value" id="ticketType">ƒêang t·∫£i...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ph·∫ßn ch·ªçn gh·∫ø -->
        <div class="seat-selection">
            <div class="selection-header">
                <h2 class="section-title">Select Your Seats</h2>
                <div class="seat-info" id="seatInfo">
                    <span class="seat-count">ƒêang t·∫£i...</span>
                    <div class="seat-types" id="seatTypes">
                        <!-- S·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t t·ª´ API -->
                    </div>
                </div>
            </div>

            <!-- M√†n h√¨nh cong v·ªõi hi·ªáu ·ª©ng ƒë·∫πp h∆°n -->
            <div class="screen-container">
                <div class="screen">
                    <span class="screen-text">SCREEN</span>
                </div>
            </div>

            <div class="seat-map" id="seatMap">
                <!-- Gh·∫ø s·∫Ω ƒë∆∞·ª£c load t·ª´ API -->
            </div>

            <!-- Legend c·∫£i ti·∫øn -->
            <div class="seat-legend">
                <div class="legend-item">
                    <div class="legend-color seat-available"></div>
                    <span>Gh·∫ø tr·ªëng</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color seat-selected"></div>
                    <span>Gh·∫ø ƒë√£ ch·ªçn</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color seat-unavailable"></div>
                    <span>Gh·∫ø ƒë√£ ƒë·∫∑t</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color seat-vip"></div>
                    <span>Gh·∫ø VIP</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Ph·∫ßn ƒë·∫∑t v√© - sidebar b√™n ph·∫£i v·ªõi style m·ªõi -->
    <div class="booking-section">
        <div class="movie-tickets-card">
            <div class="card-header">
                <h3><i class="fas fa-ticket-alt"></i> MOVIE TICKETS</h3>
                <div class="ticket-icon">üé´</div>
            </div>

            <div class="ticket-details">
                <div class="detail-row">
                    <span class="label">Date & Time</span>
                    <span class="value" id="ticketDateTime">@Model.ShowTime.ToString("dd/MM/yyyy, HH:mm")</span>
                </div>
                <div class="detail-row">
                    <span class="label">Tickets (Double comfort)</span>
                    <span class="value" id="ticketCount">@Model.SelectedSeatCount</span>
                </div>
                <div class="detail-row">
                    <span class="label">Total</span>
                    <span class="value total-amount" id="ticketTotal">@String.Format("{0:N0}", Model.TotalPrice)‚Ç´</span>
                </div>
            </div>

            <div class="selected-seats-display">
                <div class="seats-grid" id="selectedSeatsDisplay">
                    <!-- Gh·∫ø ƒë∆∞·ª£c ch·ªçn s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y -->
                </div>
            </div>

            <div class="ticket-summary">
                <div class="summary-item">
                    <span>1 Ticket Double comfort</span>
                    <span>2D</span>
                </div>
                <div class="total-price-section">
                    <span class="total-label">TOTAL PRICE</span>
                    <div class="total-row">
                        <span>T·ªïng c·ªông:</span>
                        <span class="total-amount" id="totalPrice">@String.Format("{0:N0}", Model.TotalPrice)‚Ç´</span>
                    </div>
                </div>
            </div>

            <!-- X√≥a ph·∫ßn n√†y:
            <button type="button" class="btn-add-parking">
                ADD PARKING
            </button>
            -->

            <div class="ticket-actions">
                <button id="confirmSeatsBtn" class="btn-confirm-seats" disabled>
                    CH·ªåN GH·∫æ ƒê·ªÇ TI·∫æP T·ª§C
                </button>
                <button id="continueBtn" class="btn-continue" style="display: none;">
                    THANH TO√ÅN
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const totalPriceElement = document.getElementById('totalPrice');
        const continueBtn = document.getElementById('continueBtn');
        const selectedSeatsDisplay = document.getElementById('selectedSeatsDisplay');
        const seatMapContainer = document.getElementById('seatMap');

        let selectedSeats = [];
        let maxSeats = 8; // Gi·ªõi h·∫°n t·ªëi ƒëa 8 gh·∫ø
        const showTimeId = '@Model.ShowTimeId';
        let allSeats = []; // L∆∞u tr·ªØ t·∫•t c·∫£ gh·∫ø t·ª´ API

        // C·∫£i thi·ªán h√†m loadSeats v·ªõi debug t·ªët h∆°n
        async function loadSeats() {
            try {
                console.log('Loading seats for showTimeId:', showTimeId);

                // Hi·ªÉn th·ªã loading
                seatMapContainer.innerHTML = `
                        <div id="loadingSeats" style="text-align: center; padding: 2rem; color: rgba(255,255,255,0.7);">
                            <i class="fas fa-spinner fa-spin"></i> ƒêang t·∫£i gh·∫ø...
                        </div>
                    `;

                const response = await fetch(`https://localhost:7049/api/v1/booking-ticket/available?showTimeId=${showTimeId}`, {
                    headers: {
                        'Authorization': `Bearer ${getAuthToken()}`
                    }
                });

                console.log('API Response status:', response.status);
                console.log('API Response headers:', response.headers);

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                console.log('Full API response:', JSON.stringify(data, null, 2));

                if (data.code === 200 && data.data) {
                    if (data.data.seats && data.data.seats.length > 0) {
                        allSeats = data.data.seats;
                        console.log('Seats loaded successfully:', allSeats.length, 'seats');
                        renderSeats(data.data.seats);

                        // C·∫≠p nh·∫≠t t√™n ph√≤ng
                        if (data.data.roomName) {
                            updateRoomName(data.data.roomName);
                        }
                    } else {
                        console.error('No seats found in API response');
                        throw new Error('Kh√¥ng c√≥ gh·∫ø n√†o trong ph√≤ng chi·∫øu n√†y');
                    }
                } else {
                    console.error('Invalid API response:', data);
                    throw new Error(data.message || 'Invalid API response format');
                }
            } catch (error) {
                console.error('Error loading seats:', error);
                seatMapContainer.innerHTML = `
                        <div style="text-align: center; padding: 2rem; color: #ff6b6b;">
                            <i class="fas fa-exclamation-triangle"></i>
                            ${error.message || 'Kh√¥ng th·ªÉ t·∫£i danh s√°ch gh·∫ø. Vui l√≤ng th·ª≠ l·∫°i!'}
                            <br><br>
                            <button onclick="loadSeats()" class="btn btn-primary" style="padding: 0.5rem 1rem;">
                                Th·ª≠ l·∫°i
                            </button>
                        </div>
                    `;
            }
        }

        // Render gh·∫ø t·ª´ d·ªØ li·ªáu API
        function renderSeats(seats) {
            console.log('Rendering seats:', seats);
            console.log('Total seats received:', seats.length);

            // X√≥a loading spinner
            const loadingElement = document.getElementById('loadingSeats');
            if (loadingElement) {
                loadingElement.remove();
            }

            // C·∫≠p nh·∫≠t t·ªïng s·ªë gh·∫ø trong header
            updateSeatCount(seats.length);

            // Group seats by row - s·ª≠a l·ªói group
            const seatsByRow = {};
            seats.forEach(seat => {
                const rowKey = seat.rowIndex || seat.row || 1;
                if (!seatsByRow[rowKey]) {
                    seatsByRow[rowKey] = [];
                }
                seatsByRow[rowKey].push(seat);
            });

            console.log('Seats grouped by row:', seatsByRow);

            let html = '';


            const sortedRows = Object.keys(seatsByRow).sort((a, b) => parseInt(a) - parseInt(b));
            console.log('Sorted rows:', sortedRows);

            if (sortedRows.length === 0) {
                html = `
                        <div style="text-align: center; padding: 2rem; color: #ff6b6b;">
                            <i class="fas fa-exclamation-triangle"></i>
                            Kh√¥ng c√≥ gh·∫ø n√†o ƒë∆∞·ª£c t√¨m th·∫•y!
                            <br><br>
                            <button onclick="loadSeats()" class="btn btn-primary" style="padding: 0.5rem 1rem;">
                                Th·ª≠ l·∫°i
                            </button>
                        </div>
                    `;
            } else {
                sortedRows.forEach(rowIndex => {
                    const rowSeats = seatsByRow[rowIndex].sort((a, b) => {
                        const colA = a.columnIndex || a.column || 1;
                        const colB = b.columnIndex || b.column || 1;
                        return colA - colB;
                    });

                    const rowLabel = String.fromCharCode(64 + parseInt(rowIndex)); // A, B, C...

                    html += `
                            <div class="seat-row">
                                <span class="row-label">${rowLabel}</span>
                                <div class="seats-container">
                        `;

                    rowSeats.forEach(seat => {
                        const seatClass = getSeatClass(seat);
                        const isDisabled = !seat.isAvailable;
                        const seatCode = seat.seatCode || seat.code || `${rowLabel}${seat.columnIndex || seat.column || '?'}`;
                        const seatPrice = seat.price || 0;

                        html += `
                                <button type="button" class="${seatClass}"
                                        data-seat-id="${seat.id}"
                                        data-seat-code="${seatCode}"
                                        data-seat-price="${seatPrice}"
                                        data-seat-type="${seat.seatType || 'regular'}"
                                        title="Gh·∫ø ${seatCode} - ${formatPrice(seatPrice)} VNƒê"
                                        ${isDisabled ? 'disabled' : ''}>
                                    <span class="seat-number">${seatCode}</span>
                                </button>
                            `;
                    });

                    html += `
                                </div>
                                <span class="row-label">${rowLabel}</span>
                            </div>
                        `;
                });
            }

            console.log('Generated HTML length:', html.length);
            seatMapContainer.innerHTML = html;


            attachSeatEventListeners();

            // C·∫≠p nh·∫≠t th·ªëng k√™ gh·∫ø
            updateSeatStatistics(seats);
        }

        // Th√™m h√†m c·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng gh·∫ø trong header
        function updateSeatCount(totalSeats) {
            const seatCountElement = document.querySelector('.seat-count');
            if (seatCountElement) {
                seatCountElement.textContent = `${totalSeats} Seats Total`;
            }
        }

        // Th√™m h√†m c·∫≠p nh·∫≠t th·ªëng k√™ gh·∫ø
        function updateSeatStatistics(seats) {
            const availableSeats = seats.filter(seat => seat.isAvailable).length;
            const occupiedSeats = seats.filter(seat => !seat.isAvailable).length;
            const totalSeats = seats.length;

            // L·∫•y c√°c lo·∫°i gh·∫ø duy nh·∫•t
            const seatTypes = [...new Set(seats.map(seat => seat.seatType || 'Regular'))];

            // C·∫≠p nh·∫≠t th√¥ng tin trong seat-info
            const seatInfo = document.getElementById('seatInfo');
            if (seatInfo) {
                let seatTypesHtml = '';
                seatTypes.forEach(type => {
                    const displayName = getSeatTypeDisplayName(type);
                    seatTypesHtml += `<span class="seat-type">${displayName}</span>`;
                });

                seatInfo.innerHTML = `
                        <span class="seat-count">T·ªïng: ${totalSeats} gh·∫ø</span>
                        <span class="seat-available">Tr·ªëng: ${availableSeats}</span>
                        <span class="seat-occupied">ƒê√£ ƒë·∫∑t: ${occupiedSeats}</span>
                        <div class="seat-types">
                            ${seatTypesHtml}
                        </div>
                    `;
            }

            console.log(`Seat Statistics - Total: ${totalSeats}, Available: ${availableSeats}, Occupied: ${occupiedSeats}`);
        }

        // Th√™m h√†m helper ƒë·ªÉ hi·ªÉn th·ªã t√™n lo·∫°i gh·∫ø
        function getSeatTypeDisplayName(seatType) {
            const typeMap = {
                'regular': 'Th∆∞·ªùng',
                'normal': 'Th∆∞·ªùng',
                'vip': 'VIP',
                'comfort': 'Comfort',
                'doublecomfort': 'Double Comfort',
                'double-comfort': 'Double Comfort',
                'fordisabilities': 'Ng∆∞·ªùi khuy·∫øt t·∫≠t',
                'for-disabilities': 'Ng∆∞·ªùi khuy·∫øt t·∫≠t'
            };

            return typeMap[seatType.toLowerCase()] || seatType;
        }

        // X√°c ƒë·ªãnh class CSS cho gh·∫ø d·ª±a tr√™n lo·∫°i v√† tr·∫°ng th√°i
        function getSeatClass(seat) {
            let baseClass = 'seat';

            if (!seat.isAvailable) {
                return baseClass + ' occupied';
            }

            // Th√™m class theo lo·∫°i gh·∫ø - x·ª≠ l√Ω case-insensitive
            const seatType = (seat.seatType || 'regular').toLowerCase();
            switch (seatType) {
                case 'vip':
                    return baseClass + ' vip available';
                case 'comfort':
                    return baseClass + ' comfort available';
                case 'doublecomfort':
                case 'double-comfort':
                    return baseClass + ' double-comfort available';
                case 'fordisabilities':
                case 'for-disabilities':
                    return baseClass + ' for-disabilities available';
                case 'regular':
                case 'normal':
                default:
                    return baseClass + ' regular available';
            }
        }

        // Th√™m bi·∫øn global ƒë·ªÉ l∆∞u th√¥ng tin booking
        let currentBooking = null;

        // Th√™m h√†m x√°c nh·∫≠n t·∫•t c·∫£ gh·∫ø ƒë√£ ch·ªçn
        async function confirmAllSelectedSeats() {
            if (selectedSeats.length === 0) {
                alert('Vui l√≤ng ch·ªçn √≠t nh·∫•t 1 gh·∫ø');
                return false;
            }

            try {
                const confirmButton = document.getElementById('confirmSeatsBtn');
                confirmButton.disabled = true;
                confirmButton.textContent = 'ƒêANG X·ª¨ L√ù...';

                const userId = getCurrentUserId();
                const seatIds = selectedSeats.map(s => s.id);
                
                const requestData = {
                    showTimeId: showTimeId,
                    seatIds: seatIds,
                    userId: userId
                };

                const response = await fetch('https://localhost:7049/api/v1/booking-ticket/confirm', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${getAuthToken()}`
                    },
                    body: JSON.stringify(requestData)
                });

                const result = await response.json();
                
                if (result.code === 200) {
                    // L∆∞u th√¥ng tin booking
                    currentBooking = {
                        bookingId: result.data.bookingId,
                        total: result.data.total,
                        seats: result.data.seats
                    };
                    console.log('All seats confirmed, booking info:', currentBooking);
                    
                    // ·∫®n n√∫t x√°c nh·∫≠n gh·∫ø v√† hi·ªán n√∫t thanh to√°n
                    confirmButton.style.display = 'none';
                    continueBtn.style.display = 'block';
                    
                    alert('ƒê√£ x√°c nh·∫≠n gh·∫ø th√†nh c√¥ng! B·∫°n c√≥ th·ªÉ ti·∫øn h√†nh thanh to√°n.');
                    return true;
                } else {
                    alert(result.message || 'Kh√¥ng th·ªÉ x√°c nh·∫≠n gh·∫ø');
                    return false;
                }
            } catch (error) {
                console.error('Error confirming seats:', error);
                alert('C√≥ l·ªói x·∫£y ra khi x√°c nh·∫≠n gh·∫ø');
                return false;
            } finally {
                const confirmButton = document.getElementById('confirmSeatsBtn');
                confirmButton.disabled = false;
                updateContinueButtonState();
            }
        }

        // Th√™m h√†m g·ªçi API confirm booking
        async function confirmSeatSelection(seatId, isSelected) {
            try {
                // L·∫•y userId t·ª´ session ho·∫∑c token
                const userId = getCurrentUserId(); // B·∫°n c·∫ßn implement h√†m n√†y
                
                const requestData = {
                    showTimeId: showTimeId,
                    seatIds: [seatId],
                    userId: userId
                };

                const response = await fetch('https://localhost:7049/api/v1/booking-ticket/confirm', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${getAuthToken()}` // N·∫øu c·∫ßn authentication
                    },
                    body: JSON.stringify(requestData)
                });

                const result = await response.json();
                
                if (result.code === 200) {
                    console.log('Seat confirmed successfully:', result);
                    
                    // L∆∞u th√¥ng tin booking t·ª´ response
                    if (result.data) {
                        currentBooking = {
                            bookingId: result.data.bookingId,
                            total: result.data.total,
                            seats: result.data.seats
                        };
                        console.log('Booking info saved:', currentBooking);
                    }
                    
                    return true;
                } else {
                    console.error('Failed to confirm seat:', result.message);
                    alert(result.message || 'Kh√¥ng th·ªÉ x√°c nh·∫≠n gh·∫ø n√†y');
                    return false;
                }
            } catch (error) {
                console.error('Error confirming seat:', error);
                alert('C√≥ l·ªói x·∫£y ra khi x√°c nh·∫≠n gh·∫ø. Vui l√≤ng th·ª≠ l·∫°i!');
                return false;
            }
        }

        // G·∫Øn event listeners cho gh·∫ø - PHI√äN B·∫¢N M·ªöI
        function attachSeatEventListeners() {
            const seats = document.querySelectorAll('.seat:not([disabled])');

            seats.forEach(seat => {
                seat.addEventListener('click', function () {
                    const seatId = this.dataset.seatId;
                    const seatCode = this.dataset.seatCode;
                    const seatPrice = parseFloat(this.dataset.seatPrice);
                    const seatType = this.dataset.seatType;

                    if (this.classList.contains('selected')) {
                        // B·ªè ch·ªçn gh·∫ø - ch·ªâ c·∫≠p nh·∫≠t UI, kh√¥ng g·ªçi API
                        this.classList.remove('selected');
                        selectedSeats = selectedSeats.filter(s => s.id !== seatId);
                    } else {
                        // Ch·ªçn gh·∫ø - ch·ªâ c·∫≠p nh·∫≠t UI, kh√¥ng g·ªçi API
                        if (selectedSeats.length < maxSeats) {
                            this.classList.add('selected');
                            selectedSeats.push({
                                id: seatId,
                                code: seatCode,
                                price: seatPrice,
                                type: seatType
                            });
                        } else {
                            alert(`B·∫°n ch·ªâ c√≥ th·ªÉ ch·ªçn t·ªëi ƒëa ${maxSeats} gh·∫ø.`);
                        }
                    }

                    updateDisplay();
                    updateContinueButtonState(); // C·∫≠p nh·∫≠t tr·∫°ng th√°i n√∫t ti·∫øp t·ª•c
                });
            });
        }

        // Th√™m h√†m c·∫≠p nh·∫≠t tr·∫°ng th√°i n√∫t ti·∫øp t·ª•c
        function updateContinueButtonState() {
            const confirmButton = document.getElementById('confirmSeatsBtn');
            if (confirmButton) {
                if (selectedSeats.length > 0) {
                    confirmButton.disabled = false;
                    confirmButton.textContent = `X√ÅC NH·∫¨N ${selectedSeats.length} GH·∫æ`;
                } else {
                    confirmButton.disabled = true;
                    confirmButton.textContent = 'CH·ªåN GH·∫æ ƒê·ªÇ TI·∫æP T·ª§C';
                }
            }
        }

        // C·∫≠p nh·∫≠t t√™n ph√≤ng
        function updateRoomName(roomName) {
            console.log('Updating room name:', roomName);

            // C·∫≠p nh·∫≠t t√™n ph√≤ng trong showtime info
            const roomElements = document.querySelectorAll('.showtime-value');
            if (roomElements.length > 0 && roomName) {
                roomElements[0].textContent = roomName; // Ph·∫ßn t·ª≠ ƒë·∫ßu ti√™n l√† r·∫°p chi·∫øu
                console.log('Room name updated to:', roomName);
            }

            // C·∫≠p nh·∫≠t th√™m trong header n·∫øu c√≥
            const sectionTitle = document.querySelector('.section-title');
            if (sectionTitle) {
                sectionTitle.textContent = `Select Your Seats - ${roomName}`;
            }
        }

        // Format gi√° ti·ªÅn
        function formatPrice(price) {
            return new Intl.NumberFormat('vi-VN').format(price);
        }

        // C·∫≠p nh·∫≠t hi·ªÉn th·ªã gh·∫ø ƒë√£ ch·ªçn v√† t·ªïng ti·ªÅn
        function updateDisplay() {
            // C·∫≠p nh·∫≠t hi·ªÉn th·ªã gh·∫ø ƒë√£ ch·ªçn
            if (selectedSeats.length === 0) {
                selectedSeatsDisplay.innerHTML = '<div style="text-align: center; color: rgba(255,255,255,0.6); padding: 1rem;">Ch∆∞a ch·ªçn gh·∫ø n√†o</div>';
            } else {
                selectedSeatsDisplay.innerHTML = selectedSeats.map(seat =>
                    `<div class="selected-seat-item" style="background: rgba(255,255,255,0.2); padding: 0.3rem 0.6rem; border-radius: 5px; font-size: 0.8rem;">${seat.code}</div>`
                ).join('');
            }

            // C·∫≠p nh·∫≠t t·ªïng ti·ªÅn
            const total = selectedSeats.reduce((sum, seat) => sum + seat.price, 0);
            totalPriceElement.textContent = formatPrice(total) + '‚Ç´';

            // C·∫¨P NH·∫¨T T·ªîNG TI·ªÄN TRONG TICKET DETAILS
            const ticketTotalElement = document.getElementById('ticketTotal');
            if (ticketTotalElement) {
                ticketTotalElement.textContent = formatPrice(total) + '‚Ç´';
            }

            // C·∫¨P NH·∫¨T S·ªê L∆Ø·ª¢NG V√â TRONG TICKET DETAILS
            const ticketCountElement = document.getElementById('ticketCount');
            if (ticketCountElement) {
                ticketCountElement.textContent = selectedSeats.length;
            }

            // C·∫≠p nh·∫≠t s·ªë gh·∫ø ƒë√£ ch·ªçn trong header
            const seatCountInHeader = document.querySelector('.seat-count');
            if (seatCountInHeader && allSeats.length > 0) {
                seatCountInHeader.textContent = `${selectedSeats.length}/${allSeats.length} Seats Selected`;
            }

            // Enable/disable n√∫t ti·∫øp t·ª•c
            continueBtn.disabled = selectedSeats.length === 0;
        }

        // H√†m helper ƒë·ªÉ l·∫•y userId hi·ªán t·∫°i
        function getCurrentUserId() {
            // Implement logic ƒë·ªÉ l·∫•y userId t·ª´:
            // 1. Session storage
            // 2. Local storage  
            // 3. JWT token
            // 4. Cookie
            // 5. Hidden input field
            
            // V√≠ d·ª• t·ª´ session storage:
            return sessionStorage.getItem('userId') || localStorage.getItem('userId');
            
            // Ho·∫∑c t·ª´ JWT token:
            // const token = getAuthToken();
            // if (token) {
            //     const payload = JSON.parse(atob(token.split('.')[1]));
            //     return payload.sub || payload.userId;
            // }
            // return null;
        }

        // H√†m helper ƒë·ªÉ l·∫•y auth token n·∫øu c·∫ßn
        function getAuthToken() {
            return sessionStorage.getItem('jwtToken') || localStorage.getItem('jwtToken') ||
                   localStorage.getItem('authToken') || sessionStorage.getItem('authToken');
        }

        // Validate gh·∫ø tr∆∞·ªõc khi chuy·ªÉn trang
        async function validateAndContinue() {
            if (selectedSeats.length === 0) {
                alert('Vui l√≤ng ch·ªçn √≠t nh·∫•t 1 gh·∫ø');
                return;
            }

            try {
                const seatIds = selectedSeats.map(s => s.id);
                const seatNames = selectedSeats.map(s => s.seatNumber || s.name).join(',');

                console.log('Selected seats for validation:', selectedSeats);
                console.log('Seat IDs:', seatIds);
                console.log('Seat Names:', seatNames);

                const response = await fetch(`https://localhost:7049/api/v1/booking-ticket/validate?showTimeId=${showTimeId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${getAuthToken()}`
                    },
                    body: JSON.stringify(seatIds)
                });

                const result = await response.json();

                if (result.code === 200) {
                    // Gh·∫ø h·ª£p l·ªá, chuy·ªÉn trang v·ªõi th√™m th√¥ng tin t√™n gh·∫ø
                    const seatIdsParam = seatIds.join(',');
                    const seatNamesParam = encodeURIComponent(seatNames);
                    window.location.href = `/BookingManagement/Booking/ConfirmBooking?showTimeId=${showTimeId}&seatIds=${seatIdsParam}&seatNames=${seatNamesParam}`;
                } else {
                    alert(result.message || 'Gh·∫ø ƒë√£ ch·ªçn kh√¥ng h·ª£p l·ªá. Vui l√≤ng ch·ªçn l·∫°i!');
                    // Reload l·∫°i gh·∫ø ƒë·ªÉ c·∫≠p nh·∫≠t tr·∫°ng th√°i
                    selectedSeats = [];
                    loadSeats();
                }
            } catch (error) {
                console.error('L·ªói validate gh·∫ø:', error);
                alert('C√≥ l·ªói x·∫£y ra khi ki·ªÉm tra gh·∫ø. Vui l√≤ng th·ª≠ l·∫°i!');
            }
        }

        // G·ªçi API ƒë·ªÉ l·∫•y chi ti·∫øt su·∫•t chi·∫øu v√† th√¥ng tin phim
        async function loadMovieAndShowtimeDetails() {
            try {
                console.log('Loading showtime details for showTimeId:', showTimeId);

                const showtimeResponse = await fetch(`https://localhost:7049/api/v1/booking-ticket/showtime/${showTimeId}/details`, {
                    headers: {
                        'Authorization': `Bearer ${getAuthToken()}`
                    }
                });
                if (!showtimeResponse.ok) {
                    throw new Error('Kh√¥ng th·ªÉ l·∫•y th√¥ng tin su·∫•t chi·∫øu');
                }
                const showtimeData = await showtimeResponse.json();
                console.log('Showtime data:', showtimeData);

                if (showtimeData.code === 200 && showtimeData.data) {
                    const movieId = showtimeData.data.movieId;
                    console.log('MovieId from showtime:', movieId);

                    const movieIdParam = typeof movieId === 'string' ? movieId : movieId.toString();

                    const movieResponse = await fetch(`https://localhost:7049/api/v1/movie/GetById?movieId=${movieIdParam}`, {
                        headers: {
                            'Authorization': `Bearer ${getAuthToken()}`
                        }
                    });

                    if (!movieResponse.ok) {
                        console.error('Movie API error:', movieResponse.status);
                        return;
                    }

                    const movieData = await movieResponse.json();
                    console.log('Movie data:', movieData);

                    if (movieData.code === 200 && movieData.data) {
                        updateMovieInfo(movieData.data);
                        updateShowtimeInfo(showtimeData.data);
                    }
                }
            } catch (error) {
                console.error('L·ªói khi t·∫£i th√¥ng tin:', error);
            }
        }

        // C·∫≠p nh·∫≠t th√¥ng tin phim
        function updateMovieInfo(movieInfo) {
            // C·∫≠p nh·∫≠t ti√™u ƒë·ªÅ phim
            const movieTitles = document.querySelectorAll('.movie-title');
            movieTitles.forEach(title => {
                if (movieInfo.title) {
                    title.textContent = movieInfo.title;
                }
            });

            // C·∫≠p nh·∫≠t poster phim
            const moviePoster = document.querySelector('.movie-poster');
            if (moviePoster && movieInfo.primaryImageUrl) {
                moviePoster.innerHTML = `
                        <img src="${movieInfo.primaryImageUrl}"
                             alt="${movieInfo.title || 'Movie Poster'}"
                             style="width: 100%; height: 100%; object-fit: cover; border-radius: 10px;"
                             onerror="this.src='/images/placeholder-movie.jpg';" />
                    `;
            }

            // C·∫≠p nh·∫≠t m√¥ t·∫£ phim
            const movieDescription = document.getElementById('movieDescription');
            if (movieDescription && movieInfo.content) {
                movieDescription.textContent = movieInfo.content;
            }

            // C·∫≠p nh·∫≠t th√¥ng tin meta
            const movieMeta = document.getElementById('movieMeta');
            if (movieMeta && movieInfo) {
                let metaHtml = '';

                // Th·ªÉ lo·∫°i phim
                if (movieInfo.genres && movieInfo.genres.length > 0) {
                    const genreNames = movieInfo.genres.map(g => g.name || g).join(', ');
                    metaHtml += `<span class="meta-item">üé¨ ${genreNames}</span>`;
                } else {
                    metaHtml += `<span class="meta-item">üé¨ Phim ƒëi·ªán ·∫£nh</span>`;
                }

                // Th·ªùi l∆∞·ª£ng phim
                if (movieInfo.runningTime) {
                    metaHtml += `<span class="meta-item">‚è±Ô∏è ${movieInfo.runningTime} ph√∫t</span>`;
                } else {
                    metaHtml += `<span class="meta-item">‚è±Ô∏è Ch∆∞a c·∫≠p nh·∫≠t</span>`;
                }

                // ƒê√°nh gi√°
                if (movieInfo.rating) {
                    metaHtml += `<span class="meta-item">‚≠ê ${movieInfo.rating}/10</span>`;
                } else {
                    metaHtml += `<span class="meta-item">‚≠ê Ch∆∞a ƒë√°nh gi√°</span>`;
                }

                // ƒê·∫°o di·ªÖn
                if (movieInfo.director) {
                    metaHtml += `<span class="meta-item">üé≠ ${movieInfo.director}</span>`;
                }

                movieMeta.innerHTML = metaHtml;
            }
        }

        // C·∫≠p nh·∫≠t th√¥ng tin su·∫•t chi·∫øu
        function updateShowtimeInfo(showtimeInfo) {
            if (showtimeInfo.showDate) {
                const showDate = new Date(showtimeInfo.showDate);

                // C·∫≠p nh·∫≠t ng√†y chi·∫øu trong showtime info
                const showDateElement = document.getElementById('showDate');
                if (showDateElement) {
                    showDateElement.textContent = showDate.toLocaleDateString('vi-VN');
                }

                // C·∫≠p nh·∫≠t gi·ªù chi·∫øu trong showtime info
                const showTimeElement = document.getElementById('showTime');
                if (showTimeElement) {
                    const hours = showDate.getUTCHours().toString().padStart(2, '0');
                    const minutes = showDate.getUTCMinutes().toString().padStart(2, '0');
                    showTimeElement.textContent = `${hours}:${minutes}`;
                }

                // C·∫¨P NH·∫¨T NG√ÄY GI·ªú TRONG TICKET DETAILS
                const ticketDateTimeElement = document.getElementById('ticketDateTime');
                if (ticketDateTimeElement) {
                    const formattedDate = showDate.toLocaleDateString('vi-VN');
                    const formattedTime = showDate.getUTCHours().toString().padStart(2, '0') + ':' + showDate.getUTCMinutes().toString().padStart(2, '0');
                    ticketDateTimeElement.textContent = `${formattedDate}, ${formattedTime}`;
                }
            }

            // C·∫≠p nh·∫≠t t√™n ph√≤ng chi·∫øu
            if (showtimeInfo.cinemaRoomName) {
                const cinemaRoomElement = document.getElementById('cinemaRoom');
                if (cinemaRoomElement) {
                    cinemaRoomElement.textContent = showtimeInfo.cinemaRoomName;
                }
            }

            // C·∫≠p nh·∫≠t lo·∫°i v√©
            const ticketTypeElement = document.getElementById('ticketType');
            if (ticketTypeElement) {
                const ticketType = showtimeInfo.version || 'V√© th∆∞·ªùng';
                ticketTypeElement.textContent = ticketType;
            }
        }


        continueBtn.addEventListener('click', async function() {
            if (selectedSeats.length === 0) {
                alert('Vui l√≤ng ch·ªçn √≠t nh·∫•t 1 gh·∫ø');
                return;
            }

            if (!currentBooking || !currentBooking.bookingId) {
                alert('Ch∆∞a c√≥ th√¥ng tin ƒë·∫∑t v√©. Vui l√≤ng th·ª≠ l·∫°i!');
                return;
            }

            try {
                continueBtn.disabled = true;
                continueBtn.textContent = 'ƒêANG X·ª¨ L√ù...';

                const vnpayResponse = await fetch('https://localhost:7049/api/v1/payment/vnpay', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${getAuthToken()}`
                    },
                    body: JSON.stringify({
                        bookingId: currentBooking.bookingId,
                        amount: currentBooking.total,
                        decription: `Thanh to√°n v√© phim - Booking ${currentBooking.bookingId}`
                    })
                });

                // API tr·∫£ v·ªÅ string URL tr·ª±c ti·∫øp, kh√¥ng ph·∫£i JSON
                if (vnpayResponse.ok) {
                    const paymentUrl = await vnpayResponse.text(); // ƒê·ªçc nh∆∞ text, kh√¥ng ph·∫£i JSON
                    console.log('VNPay URL:', paymentUrl);
                    // Chuy·ªÉn h∆∞·ªõng ƒë·∫øn VNPay
                    window.location.href = paymentUrl;
                } else {
                    alert('C√≥ l·ªói x·∫£y ra khi t·∫°o thanh to√°n VNPay');
                }
            } catch (error) {
                console.error('Error calling VNPay API:', error);
                alert('C√≥ l·ªói x·∫£y ra khi k·∫øt n·ªëi VNPay. Vui l√≤ng th·ª≠ l·∫°i!');
            } finally {
                continueBtn.disabled = false;
                continueBtn.textContent = 'BUY';
            }
        });

        // Th√™m event listener cho n√∫t x√°c nh·∫≠n gh·∫ø
        const confirmSeatsBtn = document.getElementById('confirmSeatsBtn');
        if (confirmSeatsBtn) {
            confirmSeatsBtn.addEventListener('click', confirmAllSelectedSeats);
        }

        // Kh·ªüi t·∫°o
        updateDisplay();
        loadSeats(); // Load gh·∫ø t·ª´ API
        loadMovieAndShowtimeDetails(); // Load th√¥ng tin phim
    });
</script>