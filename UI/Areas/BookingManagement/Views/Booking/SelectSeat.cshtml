@model SelectSeatViewModel
@{
    ViewData["Title"] = "Ch·ªçn Gh·∫ø";
    Layout = "_Layout";
}

<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
        color: white;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        min-height: 100vh;
    }

    .main-container {
        display: grid;
        grid-template-columns: 1fr 400px;
        gap: 2rem;
        padding: 2rem;
        max-width: 1400px;
        margin: 0 auto;
        min-height: 100vh;
    }

    .movie-section {
        display: flex;
        flex-direction: column;
        gap: 2rem;
    }

    .movie-info-card {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 20px;
        padding: 2rem;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        gap: 2rem;
        align-items: flex-start;
    }

    .movie-poster {
        flex-shrink: 0;
        width: 200px;
        height: 300px;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 300"><defs><radialGradient id="bg" cx="50%" cy="30%"><stop offset="0%" stop-color="%23003366"/><stop offset="100%" stop-color="%23001122"/></radialGradient></defs><rect width="100%" height="100%" fill="url(%23bg)"/><circle cx="100" cy="100" r="50" fill="rgba(255,255,255,0.1)"/><text x="100" y="120" text-anchor="middle" fill="white" font-size="16" font-family="Arial">AVATAR</text><text x="100" y="140" text-anchor="middle" fill="white" font-size="8" font-family="Arial">THE WAY OF WATER</text><text x="100" y="280" text-anchor="middle" fill="white" font-size="8" font-family="Arial">DECEMBER</text></svg>') center/cover;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
    }

        .movie-poster img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

    .movie-details {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .movie-title {
        font-size: 2.5rem;
        font-weight: bold;
        margin-bottom: 0.5rem;
        background: linear-gradient(45deg, #fff, #87ceeb);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .movie-meta {
        display: flex;
        gap: 1rem;
        margin-bottom: 1rem;
        flex-wrap: wrap;
    }

    .meta-item {
        background: rgba(255, 255, 255, 0.1);
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-size: 0.9rem;
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .movie-description {
        color: rgba(255, 255, 255, 0.8);
        line-height: 1.6;
        font-size: 1rem;
        margin-bottom: 1rem;
    }

    .showtime-info {
        background: linear-gradient(45deg, #667eea, #764ba2);
        padding: 1.5rem;
        border-radius: 15px;
        margin-top: 1rem;
    }

    .showtime-details {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 1rem;
        text-align: center;
    }

    .showtime-item {
        background: rgba(255, 255, 255, 0.1);
        padding: 1rem;
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .showtime-label {
        font-size: 0.9rem;
        color: rgba(255, 255, 255, 0.8);
        margin-bottom: 0.5rem;
    }

    .showtime-value {
        font-size: 1.1rem;
        font-weight: bold;
        color: white;
    }

/* CSS c·∫£i ti·∫øn cho ph·∫ßn ch·ªçn gh·∫ø */
.seat-selection {
    flex: 1;
    padding: 2rem;
    background: rgba(255, 255, 255, 0.02);
    border-radius: 20px;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.selection-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.section-title {
    font-size: 1.8rem;
    font-weight: 600;
    color: white;
    margin: 0;
}

.seat-info {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.seat-count {
    color: rgba(255, 255, 255, 0.8);
    font-size: 0.9rem;
}

.seat-types {
    display: flex;
    gap: 0.5rem;
}

.seat-type {
    background: rgba(255, 255, 255, 0.1);
    padding: 0.3rem 0.8rem;
    border-radius: 15px;
    font-size: 0.8rem;
    color: white;
}

/* M√†n h√¨nh cong c·∫£i ti·∫øn */
.screen-container {
    display: flex;
    justify-content: center;
    margin: 2rem 0 3rem 0;
    perspective: 1000px;
}

.screen {
    width: 80%;
    height: 8px;
    background: linear-gradient(90deg, 
        transparent 0%, 
        rgba(135, 206, 250, 0.8) 20%, 
        rgba(135, 206, 250, 1) 50%, 
        rgba(135, 206, 250, 0.8) 80%, 
        transparent 100%);
    border-radius: 50px;
    position: relative;
    transform: rotateX(45deg) rotateY(0deg);
    box-shadow: 
        0 0 20px rgba(135, 206, 250, 0.5),
        0 5px 15px rgba(0, 0, 0, 0.3);
}

.screen-text {
    position: absolute;
    top: -25px;
    left: 50%;
    transform: translateX(-50%);
    color: rgba(255, 255, 255, 0.6);
    font-size: 0.8rem;
    letter-spacing: 2px;
    font-weight: 300;
}

/* C·∫£i ti·∫øn seat map */
.seat-map {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.8rem;
    margin-bottom: 2rem;
    padding: 2rem;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 15px;
    border: 1px solid rgba(255, 255, 255, 0.05);
}

.seat-row {
    display: flex;
    align-items: center;
    gap: 1rem;
    width: 100%;
    justify-content: center;
}

.row-label {
    color: rgba(255, 255, 255, 0.6);
    font-weight: 600;
    font-size: 0.9rem;
    width: 20px;
    text-align: center;
}

.seats-container {
    display: flex;
    gap: 0.5rem;
    align-items: center;
}

/* C·∫£i ti·∫øn style gh·∫ø */
.seat {
    width: 35px;
    height: 35px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.75rem;
    font-weight: 600;
    color: white;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.seat.regular.available {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.3);
}

.seat.regular.available:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: scale(1.1);
    box-shadow: 0 0 15px rgba(255, 255, 255, 0.3);
}

.seat.vip.available {
    background: linear-gradient(45deg, #f5c518, #ffd700);
    border: 1px solid #ffd700;
    color: #000;
}

.seat.vip.available:hover {
    transform: scale(1.1);
    box-shadow: 0 0 15px rgba(245, 197, 24, 0.5);
}

.seat.selected {
    background: linear-gradient(45deg, #667eea, #764ba2) !important;
    border: 1px solid #764ba2 !important;
    color: white !important;
    transform: scale(1.1);
    box-shadow: 0 0 20px rgba(102, 126, 234, 0.6);
}

.seat.occupied {
    background: #666 !important;
    border: 1px solid #555 !important;
    cursor: not-allowed;
    opacity: 0.5;
}

/* Legend c·∫£i ti·∫øn */
.seat-legend {
    display: flex;
    justify-content: center;
    gap: 1.5rem;
    flex-wrap: wrap;
    padding: 1rem;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 10px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.8);
}

.legend-seat {
    width: 16px;
    height: 16px;
    border-radius: 4px;
    border: 1px solid rgba(255, 255, 255, 0.3);
}

.legend-seat.normal {
    background: rgba(255, 255, 255, 0.1);
}

.legend-seat.comfort {
    background: rgba(255, 255, 255, 0.2);
}

.legend-seat.double-comfort {
    background: linear-gradient(45deg, #f5c518, #ffd700);
}

.legend-seat.available {
    background: rgba(255, 255, 255, 0.1);
}

.legend-seat.for-disabilities {
    background: rgba(0, 150, 255, 0.6);
}

.legend-seat.selected {
    background: linear-gradient(45deg, #667eea, #764ba2);
}

.legend-seat.taken {
    background: #666;
}

/* Booking section c·∫£i ti·∫øn */
.booking-section {
    width: 350px;
    padding: 1rem;
}

.movie-tickets-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 20px;
    padding: 1.5rem;
    color: white;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
}

.card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.2);
}

.card-header h3 {
    margin: 0;
    font-size: 1rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.ticket-icon {
    font-size: 1.5rem;
}

.ticket-details {
    margin-bottom: 1.5rem;
}

.detail-row {
    display: flex;
    justify-content: space-between;
    margin-bottom: 0.8rem;
    font-size: 0.9rem;
}

.label {
    color: rgba(255, 255, 255, 0.8);
}

.value {
    font-weight: 600;
}

.total-amount {
    font-size: 1.1rem;
    font-weight: 700;
}

.selected-seats-display {
    margin: 1.5rem 0;
    padding: 1rem;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    min-height: 60px;
}

.seats-grid {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
    justify-content: center;
}

.ticket-summary {
    margin: 1.5rem 0;
    padding: 1rem;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
}

.summary-item {
    display: flex;
    justify-content: space-between;
    margin-bottom: 1rem;
    font-size: 0.9rem;
}

.total-price-section {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-weight: 700;
    font-size: 1.1rem;
    padding-top: 1rem;
    border-top: 1px solid rgba(255, 255, 255, 0.2);
}

.btn-buy {
    width: 100%;
    padding: 1rem;
    background: rgba(0, 0, 0, 0.8);
    border: none;
    border-radius: 10px;
    color: white;
    font-weight: 700;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.3s ease;
}

.btn-buy:hover:not(:disabled) {
    background: rgba(0, 0, 0, 0.9);
    transform: translateY(-2px);
}

.btn-buy:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

/* Responsive */
@@media (max-width: 768px) {
    .main-container {
        flex-direction: column;
    }
    
    .booking-section {
        width: 100%;
        margin-top: 2rem;
    }
    
    .seat {
        width: 30px;
        height: 30px;
        font-size: 0.7rem;
    }
    
    .seat-legend {
        gap: 1rem;
    }
}

    .btn {
        padding: 0.8rem 1.5rem;
        border: none;
        border-radius: 25px;
        cursor: pointer;
        transition: all 0.3s;
        font-weight: 500;
        font-size: 1rem;
        width: 100%;
        margin-bottom: 1rem;
    }

    .btn-primary {
        background: linear-gradient(45deg, #28a745, #20c997);
        color: white;
        border: 1px solid transparent;
    }

    .btn-secondary {
        background: rgba(255, 255, 255, 0.1);
        color: white;
        border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .btn:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    .btn:disabled {
        background: rgba(255, 255, 255, 0.1) !important;
        color: rgba(255, 255, 255, 0.3) !important;
        cursor: not-allowed;
        transform: none !important;
    }

    .btn-primary:hover:not(:disabled) {
        box-shadow: 0 10px 20px rgba(40, 167, 69, 0.3);
    }

    @@media (max-width: 1024px) {
        .main-container {
            grid-template-columns: 1fr;
        }

        .movie-info-card {
            flex-direction: column;
            text-align: center;
        }

        .movie-poster {
            width: 150px;
            height: 225px;
            margin: 0 auto;
        }

        .seat {
            width: 25px;
            height: 25px;
            font-size: 0.6rem;
        }

        .movie-title {
            font-size: 1.8rem;
        }

        .booking-section {
            position: relative;
            top: 0;
        }
    }
</style>

<div class="main-container">
    <!-- Ph·∫ßn th√¥ng tin phim v√† ch·ªçn gh·∫ø -->
    <div class="movie-section">
        <!-- Th√¥ng tin phim -->
        <div class="movie-info-card">
            <div class="movie-poster">
                <div class="movie-poster">
                    <h1 class="movie-title">@Model.MovieTitle</h1>
                </div>
            </div>

            <div class="movie-details">
                <h1 class="movie-title">@Model.MovieTitle</h1>

                <div class="movie-meta">
                    <span class="meta-item">üìΩÔ∏è Phim ƒëi·ªán ·∫£nh</span>
                    <span class="meta-item">‚è±Ô∏è 120 ph√∫t</span>
                    <span class="meta-item">‚≠ê 8.5/10</span>
                    <span class="meta-item">üé¨ H√†nh ƒë·ªông</span>
                </div>

                <div class="movie-description">
                    M·ªôt b·ªô phim h·∫•p d·∫´n v·ªõi c·ªët truy·ªán ly k·ª≥ v√† di·ªÖn xu·∫•t xu·∫•t s·∫Øc.
                </div>

                <!-- Th√¥ng tin su·∫•t chi·∫øu -->
                <div class="showtime-info">
                    <div class="showtime-details">
                        <div class="showtime-item">
                            <div class="showtime-label">üé≠ R·∫°p chi·∫øu</div>
                            <div class="showtime-value">@Model.CinemaRoom</div>
                        </div>
                        <div class="showtime-item">
                            <div class="showtime-label">üìÖ Ng√†y chi·∫øu</div>
                            <div class="showtime-value">@Model.ShowTime.ToString("dd/MM/yyyy")</div>
                        </div>
                        <div class="showtime-item">
                            <div class="showtime-label">üïê Gi·ªù chi·∫øu</div>
                            <div class="showtime-value">@Model.ShowTime.ToString("HH:mm")</div>
                        </div>
                        <div class="showtime-item">
                            <div class="showtime-label">üé´ Lo·∫°i v√©</div>
                            <div class="showtime-value">V√© th∆∞·ªùng</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ph·∫ßn ch·ªçn gh·∫ø -->
        <div class="seat-selection">
            <div class="selection-header">
                <h2 class="section-title">Select Your Seats</h2>
                <div class="seat-info">
                    <span class="seat-count">@Model.SelectedSeatCount Seats</span>
                    <div class="seat-types">
                        <span class="seat-type">D-BOX</span>
                        <span class="seat-type">D-11</span>
                    </div>
                </div>
            </div>

            <!-- M√†n h√¨nh cong v·ªõi hi·ªáu ·ª©ng ƒë·∫πp h∆°n -->
            <div class="screen-container">
                <div class="screen">
                    <span class="screen-text">SCREEN</span>
                </div>
            </div>

            <div class="seat-map" id="seatMap">
                @{
                    var seatsByRow = Model.Seats.GroupBy(s => s.Row).OrderBy(g => g.Key);
                }

                @foreach (var rowGroup in seatsByRow)
                {
                    <div class="seat-row">
                        <span class="row-label">@((char)('A' + rowGroup.Key - 1))</span>

                        <div class="seats-container">
                            @foreach (var seat in rowGroup.OrderBy(s => s.Column))
                            {
                                var seatClass = "seat";
                                if (seat.IsOccupied)
                                    seatClass += " occupied";
                                else if (seat.Type == SeatType.VIP)
                                    seatClass += " vip available";
                                else
                                    seatClass += " regular available";

                                <button type="button" class="@seatClass"
                                        data-seat-id="@seat.Id"
                                        data-seat-number="@seat.SeatNumber"
                                        data-seat-price="@seat.Price"
                                        data-seat-type="@seat.Type.ToString()"
                                        title="Gh·∫ø @seat.SeatNumber - @String.Format("{0:N0}", seat.Price) VNƒê"
                                @(seat.IsOccupied ? "disabled" : "")>
                                    <span class="seat-number">@seat.Column.ToString("D2")</span>
                                </button>
                            }
                        </div>

                        <span class="row-label">@((char)('A' + rowGroup.Key - 1))</span>
                    </div>
                }
            </div>

            <!-- Legend c·∫£i ti·∫øn -->
            <div class="seat-legend">
                <div class="legend-item">
                    <div class="legend-seat normal"></div>
                    <span>Normal</span>
                </div>
                <div class="legend-item">
                    <div class="legend-seat comfort"></div>
                    <span>Comfort</span>
                </div>
                <div class="legend-item">
                    <div class="legend-seat double-comfort"></div>
                    <span>Double Comfort</span>
                </div>
                <div class="legend-item">
                    <div class="legend-seat available"></div>
                    <span>Available</span>
                </div>
                <div class="legend-item">
                    <div class="legend-seat for-disabilities"></div>
                    <span>For Disabilities</span>
                </div>
                <div class="legend-item">
                    <div class="legend-seat selected"></div>
                    <span>Selected</span>
                </div>
                <div class="legend-item">
                    <div class="legend-seat taken"></div>
                    <span>Taken</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Ph·∫ßn ƒë·∫∑t v√© - sidebar b√™n ph·∫£i v·ªõi style m·ªõi -->
    <div class="booking-section">
        <div class="movie-tickets-card">
            <div class="card-header">
                <h3><i class="fas fa-ticket-alt"></i> MOVIE TICKETS</h3>
                <div class="ticket-icon">üé´</div>
            </div>

            <div class="ticket-details">
                <div class="detail-row">
                    <span class="label">Date & Time</span>
                    <span class="value">@Model.ShowTime.ToString("dd/MM/yyyy, HH:mm")</span>
                </div>
                <div class="detail-row">
                    <span class="label">Tickets (Double comfort)</span>
                    <span class="value">@Model.SelectedSeatCount</span>
                </div>
                <div class="detail-row">
                    <span class="label">Total</span>
                    <span class="value total-amount">@String.Format("{0:N0}", Model.TotalPrice)‚Ç´</span>
                </div>
            </div>

            <div class="selected-seats-display">
                <div class="seats-grid" id="selectedSeatsDisplay">
                    <!-- Gh·∫ø ƒë∆∞·ª£c ch·ªçn s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y -->
                </div>
            </div>

            <div class="ticket-summary">
                <div class="summary-item">
                    <span>1 Ticket Double comfort</span>
                    <span>2D</span>
                </div>
                <div class="total-price-section">
                    <span class="total-label">TOTAL PRICE</span>
                    <div class="total-row">
                        <span>T·ªïng c·ªông:</span>
                        <span class="total-amount" id="totalPrice">@String.Format("{0:N0}", Model.TotalPrice)‚Ç´</span>
                    </div>
                </div>
            </div>

            <!-- X√≥a ph·∫ßn n√†y:
            <button type="button" class="btn-add-parking">
                ADD PARKING
            </button>
            -->

            <button type="button" class="btn-buy" id="continueBtn">
                BUY
            </button>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const seats = document.querySelectorAll('.seat:not([disabled])');
        const totalPriceElement = document.getElementById('totalPrice');
        const continueBtn = document.getElementById('continueBtn');
        const selectedSeatsDisplay = document.getElementById('selectedSeatsDisplay');

        let selectedSeats = [];
        let maxSeats = @Model.MaxSeats;
        const showTimeId = '@Model.ShowTimeId';

        // G·ªçi API ƒë·ªÉ l·∫•y chi ti·∫øt su·∫•t chi·∫øu v√† th√¥ng tin phim
        async function loadMovieAndShowtimeDetails() {
            try {
                console.log('Loading showtime details for showTimeId:', showTimeId);
                
                // G·ªçi API l·∫•y chi ti·∫øt su·∫•t chi·∫øu
                const showtimeResponse = await fetch(`https://localhost:7049/api/v1/booking-ticket/${showTimeId}/details`);
                if (!showtimeResponse.ok) {
                    throw new Error('Kh√¥ng th·ªÉ l·∫•y th√¥ng tin su·∫•t chi·∫øu');
                }
                const showtimeData = await showtimeResponse.json();
                console.log('Showtime data:', showtimeData);
                
                if (showtimeData.code === 200 && showtimeData.data) {
                    const movieId = showtimeData.data.movieId;
                    console.log('MovieId from showtime:', movieId, 'Type:', typeof movieId);
                    
                    // Ki·ªÉm tra n·∫øu movieId l√† string GUID hay int
                    const movieIdParam = typeof movieId === 'string' ? movieId : movieId.toString();
                    console.log('Using movieId param:', movieIdParam);
                    
                    // G·ªçi API l·∫•y th√¥ng tin phim
                    const movieApiUrl = `https://localhost:7049/api/v1/movie/GetById?movieId=${movieIdParam}`;
                    console.log('Calling movie API:', movieApiUrl);
                    
                    const movieResponse = await fetch(movieApiUrl);
                    console.log('Movie response status:', movieResponse.status);
                    
                    if (!movieResponse.ok) {
                        const errorText = await movieResponse.text();
                        console.error('Movie API error:', errorText);
                        throw new Error(`Kh√¥ng th·ªÉ l·∫•y th√¥ng tin phim: ${movieResponse.status}`);
                    }
                    
                    const movieData = await movieResponse.json();
                    console.log('Movie data:', movieData);
                    
                    if (movieData.code === 200 && movieData.data) {
                        // C·∫≠p nh·∫≠t th√¥ng tin phim tr√™n giao di·ªán
                        updateMovieInfo(movieData.data);
                        updateShowtimeInfo(showtimeData.data);
                    } else {
                        console.error('Movie API returned error:', movieData);
                    }
                }
            } catch (error) {
                console.error('L·ªói khi t·∫£i th√¥ng tin:', error);
                // Hi·ªÉn th·ªã th√¥ng b√°o l·ªói cho ng∆∞·ªùi d√πng
                alert('Kh√¥ng th·ªÉ t·∫£i th√¥ng tin phim. Vui l√≤ng th·ª≠ l·∫°i!');
            }
        }

        // C·∫≠p nh·∫≠t th√¥ng tin phim
        function updateMovieInfo(movieInfo) {
            console.log('=== UPDATE MOVIE INFO DEBUG ===');
            console.log('Full movieInfo object:', movieInfo);
            console.log('PrimaryImageUrl:', movieInfo.primaryImageUrl);
            console.log('Images:', movieInfo.images);
            
            // 1. C·∫≠p nh·∫≠t t√™n phim
            const movieTitle = document.querySelector('.movie-title');
            if (movieTitle && movieInfo.title) {
                movieTitle.textContent = movieInfo.title;
                console.log('‚úì Updated movie title:', movieInfo.title);
            }

            // 2. C·∫≠p nh·∫≠t ·∫£nh poster phim - S·ª¨ D·ª§NG C·∫§U TR√öC M·ªöI
            const moviePoster = document.querySelector('.movie-poster');
            if (moviePoster) {
                let posterUrl = '/images/placeholder-movie.jpg'; // default
                
                // ∆Øu ti√™n s·ª≠ d·ª•ng PrimaryImageUrl tr∆∞·ªõc
                if (movieInfo.primaryImageUrl) {
                    posterUrl = movieInfo.primaryImageUrl;
                    console.log('‚úì Using PrimaryImageUrl:', posterUrl);
                }
                // N·∫øu kh√¥ng c√≥ PrimaryImageUrl, d√πng Images array
                else if (movieInfo.images && Array.isArray(movieInfo.images) && movieInfo.images.length > 0) {
                    console.log('Found images array:', movieInfo.images);
                    
                    // T√¨m ·∫£nh primary trong Images array
                    const primaryImage = movieInfo.images.find(img => img.isPrimary === true);
                    if (primaryImage && primaryImage.imageUrl) {
                        posterUrl = primaryImage.imageUrl;
                        console.log('‚úì Using primary image from Images:', posterUrl);
                    } else if (movieInfo.images[0] && movieInfo.images[0].imageUrl) {
                        posterUrl = movieInfo.images[0].imageUrl;
                        console.log('‚úì Using first image from Images:', posterUrl);
                    }
                } else {
                    console.log('‚ö†Ô∏è No images found, using placeholder');
                }
                
                // C·∫≠p nh·∫≠t ·∫£nh v·ªõi error handling
                moviePoster.innerHTML = `
                    <img src="${posterUrl}" 
                         alt="${movieInfo.title || 'Movie Poster'}" 
                         style="width: 100%; height: 100%; object-fit: cover; border-radius: 10px;"
                         onerror="console.error('‚ùå Image failed to load:', '${posterUrl}'); this.src='/images/placeholder-movie.jpg';" 
                         onload="console.log('‚úÖ Image loaded successfully:', '${posterUrl}');" />
                `;
                console.log('‚úì Updated movie poster with URL:', posterUrl);
            }

            // 3. C·∫≠p nh·∫≠t t√≥m t·∫Øt phim (Content)
            const movieDescription = document.querySelector('.movie-description');
            if (movieDescription && movieInfo.content) {
                movieDescription.textContent = movieInfo.content;
                console.log('‚úì Updated movie description');
            }

            // 4. C·∫≠p nh·∫≠t th√¥ng tin meta (bao g·ªìm ƒë·∫°o di·ªÖn, th·ªùi l∆∞·ª£ng, ƒë√°nh gi√°)
            const movieMeta = document.querySelector('.movie-meta');
            if (movieMeta && movieInfo) {
                let metaHtml = '';
                
                // ƒê·∫°o di·ªÖn
                if (movieInfo.director) {
                    metaHtml += `<span class="meta-item">üé¨ ƒê·∫°o di·ªÖn: ${movieInfo.director}</span>`;
                }
                
                // Th·ªùi l∆∞·ª£ng
                if (movieInfo.runningTime) {
                    metaHtml += `<span class="meta-item">‚è±Ô∏è ${movieInfo.runningTime} ph√∫t</span>`;
                }
                
                // ƒê√°nh gi√°
                if (movieInfo.rating) {
                    metaHtml += `<span class="meta-item">‚≠ê ${movieInfo.rating}/10</span>`;
                }
                
                // Di·ªÖn vi√™n
                if (movieInfo.actors) {
                    metaHtml += `<span class="meta-item">üé≠ Di·ªÖn vi√™n: ${movieInfo.actors}</span>`;
                }
                
                // C√¥ng ty s·∫£n xu·∫•t
                if (movieInfo.productionCompany) {
                    metaHtml += `<span class="meta-item">üè¢ ${movieInfo.productionCompany}</span>`;
                }
                
                movieMeta.innerHTML = metaHtml;
                console.log('‚úì Updated movie meta information');
            }

            // 5. Th√™m ph·∫ßn hi·ªÉn th·ªã trailer (n·∫øu c√≥)
            addTrailerSection(movieInfo);
            
            console.log('=== END UPDATE MOVIE INFO DEBUG ===');
        }
        
        // H√†m th√™m ph·∫ßn trailer
        function addTrailerSection(movieInfo) {
            if (movieInfo.trailerUrl) {
                // T√¨m v·ªã tr√≠ ƒë·ªÉ ch√®n trailer (sau ph·∫ßn m√¥ t·∫£)
                const movieDescription = document.querySelector('.movie-description');
                if (movieDescription) {
                    // Ki·ªÉm tra xem ƒë√£ c√≥ trailer section ch∆∞a
                    let trailerSection = document.querySelector('.trailer-section');
                    if (!trailerSection) {
                        // T·∫°o trailer section m·ªõi
                        trailerSection = document.createElement('div');
                        trailerSection.className = 'trailer-section';
                        trailerSection.style.cssText = `
                            margin-top: 1rem;
                            padding: 1rem;
                            background: rgba(255, 255, 255, 0.05);
                            border-radius: 10px;
                            border: 1px solid rgba(255, 255, 255, 0.1);
                        `;
                        
                        // Ch√®n sau ph·∫ßn m√¥ t·∫£
                        movieDescription.parentNode.insertBefore(trailerSection, movieDescription.nextSibling);
                    }
                    
                    // C·∫≠p nh·∫≠t n·ªôi dung trailer
                    trailerSection.innerHTML = `
                        <h4 style="color: white; margin-bottom: 0.5rem; font-size: 1.1rem;">üé• Trailer</h4>
                        <a href="${movieInfo.trailerUrl}" target="_blank" 
                           style="color: #87ceeb; text-decoration: none; font-size: 0.9rem;"
                           onmouseover="this.style.textDecoration='underline'"
                           onmouseout="this.style.textDecoration='none'">
                            ‚ñ∂Ô∏è Xem trailer
                        </a>
                    `;
                }
            }
        }

        // C·∫≠p nh·∫≠t th√¥ng tin su·∫•t chi·∫øu
        function updateShowtimeInfo(showtimeInfo) {
            // C·∫≠p nh·∫≠t th√¥ng tin su·∫•t chi·∫øu trong ph·∫ßn showtime-details
            const showtimeDetails = document.querySelector('.showtime-details');
            if (showtimeDetails && showtimeInfo) {
                let showtimeHtml = '';
                
                if (showtimeInfo.showDate) {
                    const showDate = new Date(showtimeInfo.showDate);
                    // Hi·ªÉn th·ªã gi·ªù UTC g·ªëc
                    showtimeHtml += `
                        <div class="showtime-item">
                            <div class="showtime-label">Ng√†y chi·∫øu</div>
                            <div class="showtime-value">${showDate.toLocaleDateString('vi-VN')}</div>
                        </div>
                        <div class="showtime-item">
                            <div class="showtime-label">Gi·ªù chi·∫øu</div>
                            <div class="showtime-value">${showDate.getUTCHours().toString().padStart(2, '0')}:${showDate.getUTCMinutes().toString().padStart(2, '0')}</div>
                        </div>
                    `;
                }
                
                // Gi·ªØ nguy√™n ph·∫ßn startTime n·∫øu c√≥ (t·ª´ d·ªØ li·ªáu ri√™ng bi·ªát)
                if (showtimeInfo.startTime) {
                    showtimeHtml += `
                        <div class="showtime-item">
                            <div class="showtime-label">Gi·ªù b·∫Øt ƒë·∫ßu</div>
                            <div class="showtime-value">${showtimeInfo.startTime}</div>
                        </div>
                    `;
                }
                
                if (showtimeInfo.roomName) {
                    showtimeHtml += `
                        <div class="showtime-item">
                            <div class="showtime-label">Ph√≤ng chi·∫øu</div>
                            <div class="showtime-value">${showtimeInfo.roomName}</div>
                        </div>
                    `;
                }
                
                showtimeDetails.innerHTML = showtimeHtml;
            }
        }

        // G·ªçi h√†m load d·ªØ li·ªáu khi trang ƒë∆∞·ª£c t·∫£i
        loadMovieAndShowtimeDetails();

        seats.forEach(seat => {
            seat.addEventListener('click', function () {
                const seatId = this.dataset.seatId;
                const seatNumber = this.dataset.seatNumber;
                const seatPrice = parseFloat(this.dataset.seatPrice);
                const seatType = this.dataset.seatType;

                if (this.classList.contains('selected')) {
                    // Deselect
                    this.classList.remove('selected');
                    selectedSeats = selectedSeats.filter(s => s.id !== seatId);
                } else {
                    // Select (if under limit)
                    if (selectedSeats.length < maxSeats) {
                        this.classList.add('selected');
                        selectedSeats.push({
                            id: seatId,
                            number: seatNumber,
                            price: seatPrice,
                            type: seatType
                        });
                    } else {
                        alert(`B·∫°n ch·ªâ c√≥ th·ªÉ ch·ªçn t·ªëi ƒëa ${maxSeats} gh·∫ø.`);
                    }
                }

                updateDisplay();
            });
        });

        continueBtn.addEventListener('click', function () {
            if (selectedSeats.length > 0) {
                const seatIds = selectedSeats.map(s => s.id).join(',');
                window.location.href = `/BookingManagement/Booking/ConfirmBooking?showTimeId=${showTimeId}&seatIds=${seatIds}`;
            }
        });

        function updateDisplay() {
            // C·∫≠p nh·∫≠t hi·ªÉn th·ªã gh·∫ø ƒë√£ ch·ªçn
            if (selectedSeats.length === 0) {
                selectedSeatsDisplay.innerHTML = '<div style="text-align: center; color: rgba(255,255,255,0.6); padding: 1rem;">Ch∆∞a ch·ªçn gh·∫ø n√†o</div>';
            } else {
                selectedSeatsDisplay.innerHTML = selectedSeats.map(seat => 
                    `<div class="selected-seat-item" style="background: rgba(255,255,255,0.2); padding: 0.3rem 0.6rem; border-radius: 5px; font-size: 0.8rem;">${seat.number}</div>`
                ).join('');
            }

            // C·∫≠p nh·∫≠t t·ªïng ti·ªÅn
            const total = selectedSeats.reduce((sum, seat) => sum + seat.price, 0);
            totalPriceElement.textContent = new Intl.NumberFormat('vi-VN').format(total) + '‚Ç´';

            // Enable/disable n√∫t ti·∫øp t·ª•c
            continueBtn.disabled = selectedSeats.length === 0;
        }

        // Kh·ªüi t·∫°o display
        updateDisplay();
    });
</script>