@using System.Security.Claims


<header class="shared-header">
    <div class="shared-nav-container">
        <div class="shared-nav-content">
            
            <div class="shared-brand">
                <a href="/" class="shared-brand-link">
                    <div class="shared-brand-logo"></div>
                    <div class="shared-brand-text">
                        <span class="shared-brand-name">Cinema City</span>
                        <span class="shared-brand-subtitle">Rạp chiếu phim hiện đại</span>
                    </div>
                </a>
            </div>

            
            <nav class="shared-nav-links">
                <a href="/" class="shared-nav-link">
                    <i class="fas fa-home"></i>
                    <span>Trang chủ</span>
                </a>
                <a href="/Movies" class="shared-nav-link">
                    <i class="fas fa-film"></i>
                    <span>Phim</span>
                </a>
                <a href="/Events" class="shared-nav-link">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Sự kiện</span>
                </a>
                <a href="/Products" class="shared-nav-link">
                    <i class="fas fa-shopping-bag"></i>
                    <span>Sản phẩm</span>
                </a>
            </nav>

            
            <div class="shared-search-box">
                <input type="text" placeholder="Tìm kiếm phim..." class="shared-search-input" id="sharedSearchInput">
                <button class="shared-search-btn" id="sharedSearchButton">
                    <i class="fas fa-search"></i>
                </button>
            </div>

            
            <div class="shared-user-section">
                @if (User.Identity?.IsAuthenticated == true)
                {
                    <div class="shared-user-dropdown">
                        <button class="shared-user-btn" id="sharedUserDropdown" data-bs-toggle="dropdown">
                            <i class="fas fa-user-circle"></i>
                            <span class="shared-user-name">
                                @if (ViewContext.HttpContext.User.Identity?.Name?.Length > 12)
                                {
                                    @(ViewContext.HttpContext.User.Identity.Name.Substring(0, 12) + "...")
                                }
                                else
                                {
                                    @ViewContext.HttpContext.User.Identity?.Name
                                }
                            </span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        
                        <ul class="shared-dropdown-menu" aria-labelledby="sharedUserDropdown">
                            <li class="shared-dropdown-header">
                                <div class="shared-user-info">
                                    <i class="fas fa-user-circle fa-2x"></i>
                                    <div class="shared-user-details">
                                        <div class="shared-user-full-name">@ViewContext.HttpContext.User.Identity?.Name</div>
                                        <div class="shared-user-email">@ViewContext.HttpContext.User.FindFirst(ClaimTypes.Email)?.Value</div>
                                    </div>
                                </div>
                            </li>
                            <li><hr class="shared-dropdown-divider"></li>
                            <li>
                                <a class="shared-dropdown-item" href="/UserManagement/Account/Profile">
                                    <i class="fas fa-user-edit"></i>
                                    <span>Chỉnh sửa thông tin</span>
                                </a>
                            </li>
                            <li>
                                <a class="shared-dropdown-item" href="/Dashboard">
                                    <i class="fas fa-tachometer-alt"></i>
                                    <span>Dashboard</span>
                                </a>
                            </li>
                            <li><hr class="shared-dropdown-divider"></li>
                            <li>
                                <form asp-action="Logout" asp-controller="Account" method="post" class="shared-logout-form">
                                    <button type="submit" class="shared-dropdown-item shared-logout-btn">
                                        <i class="fas fa-sign-out-alt"></i>
                                        <span>Đăng xuất</span>
                                    </button>
                                </form>
                            </li>
                        </ul>
                    </div>
                }
                else
                {
                    <div class="shared-auth-buttons">
                        <a href="/Account/Register" class="shared-btn shared-btn-register">
                            <i class="fas fa-user-plus"></i>
                            <span>Đăng ký</span>
                        </a>
                        <a href="/Account/Login" class="shared-btn shared-btn-login">
                            <i class="fas fa-sign-in-alt"></i>
                            <span>Đăng nhập</span>
                        </a>
                    </div>
                }
            </div>
        </div>
    </div>
</header>

<script>

    document.addEventListener('DOMContentLoaded', function () {

        const userDropdown = document.getElementById('sharedUserDropdown');
        const dropdownMenu = document.querySelector('.shared-dropdown-menu');
        
        if (userDropdown && dropdownMenu) {
            userDropdown.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                const isShowing = dropdownMenu.classList.contains('show');
                if (isShowing) {
                    dropdownMenu.classList.remove('show');
                    userDropdown.setAttribute('aria-expanded', 'false');
                } else {
                    dropdownMenu.classList.add('show');
                    userDropdown.setAttribute('aria-expanded', 'true');
                }
            });
            

            document.addEventListener('click', function(e) {
                if (!userDropdown.contains(e.target) && !dropdownMenu.contains(e.target)) {
                    dropdownMenu.classList.remove('show');
                    userDropdown.setAttribute('aria-expanded', 'false');
                }
            });
        }


        const searchInput = document.getElementById('sharedSearchInput');
        const searchButton = document.getElementById('sharedSearchButton');

        searchButton?.addEventListener('click', function () {
            performSharedSearch();
        });

        searchInput?.addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                performSharedSearch();
            }
        });

        function performSharedSearch() {
            const keyword = searchInput.value.trim();
            const searchUrl = '/Movies/Search' + (keyword ? `?keyword=${encodeURIComponent(keyword)}` : '');
            window.location.href = searchUrl;
        }
    });
</script> 