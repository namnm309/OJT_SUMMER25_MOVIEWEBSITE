@using System.Security.Claims
@using System.Text.Json
@model UI.Models.HomeViewModel
@{
	ViewData["Title"] = "Cinema City";
}

@section Styles {
	<link rel="stylesheet" href="~/css/HomePage/base.css" />
	<link rel="stylesheet" href="~/css/HomePage/header.css" />
	<link rel="stylesheet" href="~/css/Shared/_header.css" />
	<link rel="stylesheet" href="~/css/HomePage/hero.css" />
	
	<link rel="stylesheet" href="~/css/HomePage/moviecard.css" />
	<link rel="stylesheet" href="~/css/HomePage/layout.css" />
	<link rel="stylesheet" href="~/css/HomePage/button.css" />
	<link rel="stylesheet" href="~/css/HomePage/movie-poster-overlay.css" />
	<link rel="stylesheet" href="~/css/HomePage/banner.css" />
	<link rel="stylesheet" href="~/css/HomePage/responsive.css" />
	<link rel="stylesheet" href="~/css/HomePage/custom-fix.css" />
	<link rel="stylesheet" href="~/css/HomePage/custom-sections.css" />
	<link rel="stylesheet" href="~/css/MovieDetails/movie-details-mostly.css" asp-append-version="true" />

}

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">

<div class="home-new-style">
	
	<div class="hero-section" id="heroSection">
		
		<div class="hero-background" id="heroBackground">
			@{
				var initialImage = Model?.FeaturedMovie != null
				? GetMovieImageUrl(Model.FeaturedMovie)
				: "https://via.placeholder.com/1920x1080/1a1a1a/ffffff?text=Cinema+City";
			}
			
			<div class="hero-image" id="heroImage" style="background-image: url('@initialImage'); display: none; opacity: 0;"></div>

			
		</div>
		<!-- Header t·ª´ trang Details -->
		@Html.Partial("_Header")

		
		<div class="movie-content" id="movieContent">
			@if (Model?.FeaturedMovie != null)
			{
				<div class="movie-info">
					<div class="movie-header">
						<h1 class="movie-title" id="movieTitle">@Model.FeaturedMovie.Title</h1>
						<p class="movie-title-vn" id="movieTitleVn">@(Model.FeaturedMovie.Director ?? "ƒê·∫°o di·ªÖn")</p>
					</div>

					<div class="movie-details">
						<div class="plot-section">
							<h3>T√≥m t·∫Øt n·ªôi dung</h3>
							<p id="moviePlot">
								@(Model.FeaturedMovie.Content ?? "Ch∆∞a c√≥ th√¥ng tin n·ªôi dung.")
							</p>
						</div>

						<div class="genre-section">
							<h3>Th·ªÉ lo·∫°i</h3>
							<p id="movieGenre">@(Model.FeaturedMovie.Genres != null && Model.FeaturedMovie.Genres.Any() ? string.Join(", ", Model.FeaturedMovie.Genres.Select(g => g.Name)) : "Ch∆∞a ph√¢n lo·∫°i")</p>
						</div>

						<div class="ratings-section">
							<div class="rating-item">
								<i class="fas fa-clock"></i>
								<span id="duration">@Model.FeaturedMovie.RunningTime ph√∫t</span>
							</div>
						</div>

						<div class="action-buttons">
							<button class="btn-primary" onclick="bookTickets()">
								<i class="fas fa-ticket-alt"></i>
								ƒê·∫∑t v√© ngay
							</button>
							<button class="btn-secondary" onclick="showMovieInfo()">
								<i class="fas fa-info-circle"></i>
								Th√¥ng tin phim
							</button>
						</div>
					</div>
				</div>
			}
			else
			{
				<div class="movie-info">
					<div class="loading-container">
						<i class="fas fa-spinner fa-spin fa-2x"></i>
						<h3>ƒêang t·∫£i d·ªØ li·ªáu phim...</h3>
					</div>
				</div>
			}
		</div>

		
		<div class="movie-controls">
			<div class="control-left">
				<button class="nav-btn" onclick="previousMovie()">
					<i class="fas fa-chevron-left"></i>
				</button>
			</div>

			<div class="pagination-dots" id="paginationDots">
				@if (Model?.HeroMovies != null && Model.HeroMovies.Any())
				{
					for (int i = 0; i < Model.HeroMovies.Count; i++)
					{
						<span class="dot @(i == 0 ? "active" : "")" data-index="@i"></span>
					}
				}
				else
				{
					<span class="dot active"></span>
				}
			</div>

			<div class="control-right">
				<button class="nav-btn" onclick="nextMovie()">
					<i class="fas fa-chevron-right"></i>
				</button>
			</div>
		</div>
	</div>

	<!-- Phim ƒê·ªÅ Xu·∫•t - Thi·∫øt k·∫ø m·ªõi nh·∫•t qu√°n -->
	<div class="recommended-section-new">
		<div class="section-title-bar">
			<h2><i class="fas fa-star"></i> Phim ƒê·ªÅ Xu·∫•t</h2>
			<a href="@Url.Action("Index", "Movies")" class="view-all-link">
				Xem t·∫•t c·∫£ <i class="fas fa-chevron-right"></i>
			</a>
		</div>

		<!-- B·ªô l·ªçc v√† s·∫Øp x·∫øp cho Phim ƒê·ªÅ Xu·∫•t -->
		<div class="pagination-controls">
			<div class="sort-filter-controls">
				<div class="filter-group">
					<label class="filter-label">
						<i class="fas fa-sort"></i>
						<span>S·∫Øp x·∫øp theo</span>
					</label>
					<select id="recommendedSort" class="pagination-select">
						<option value="createdAt-desc">M·ªõi nh·∫•t</option>
						<option value="rating-desc">ƒê√°nh gi√° cao nh·∫•t</option>
						<option value="title-asc">T√™n A-Z</option>
						<option value="releaseDate-desc">Ng√†y ph√°t h√†nh g·∫ßn nh·∫•t</option>
					</select>
				</div>

				<div class="filter-group">
					<label class="filter-label">
						<i class="fas fa-theater-masks"></i>
						<span>Th·ªÉ lo·∫°i</span>
					</label>
					<select id="recommendedGenre" class="pagination-select">
						<option value="all">T·∫•t c·∫£ th·ªÉ lo·∫°i</option>
						<option value="h√†nh ƒë·ªông">H√†nh ƒë·ªông</option>
						<option value="t√¨nh c·∫£m">T√¨nh c·∫£m</option>
						<option value="kinh d·ªã">Kinh d·ªã</option>
						<option value="h√†i">H√†i</option>
						<option value="khoa h·ªçc vi·ªÖn t∆∞·ªüng">Khoa h·ªçc vi·ªÖn t∆∞·ªüng</option>
						<option value="phi√™u l∆∞u">Phi√™u l∆∞u</option>
					</select>
				</div>

				<div class="filter-group">
					<label class="filter-label">
						<i class="fas fa-eye"></i>
						<span>Hi·ªÉn th·ªã</span>
					</label>
					<select id="recommendedPageSize" class="pagination-select">
						<option value="6">6 phim</option>
						<option value="8">8 phim</option>
						<option value="12">12 phim</option>
					</select>
				</div>
			</div>

			<!-- Th√¥ng tin ph√¢n trang cho Phim ƒê·ªÅ Xu·∫•t -->
			<div class="pagination-info" id="recommendedInfo">
				<div class="info-content">
					<i class="fas fa-info-circle"></i>
					<span>Trang 1 / 1 (0 phim)</span>
				</div>
			</div>
		</div>

		<div class="recommended-content">
			<div class="recommended-grid">
				@if (Model?.RecommendedMovies != null && Model.RecommendedMovies.Any())
				{


					foreach (var movie in Model.RecommendedMovies.Take(5))
					{
						<div class="recommended-item movie-card">
							<div class="recommended-poster movie-poster">
								@{
									string imageUrl = movie.PrimaryImageUrl ?? movie.ImageUrl;
									if (string.IsNullOrEmpty(imageUrl) && movie.Images != null && movie.Images.Any())
									{
										var primaryImage = movie.Images.FirstOrDefault(img => img.IsPrimary) ?? movie.Images.First();
										imageUrl = primaryImage?.ImageUrl ?? "";
									}
									imageUrl = imageUrl ?? "https://via.placeholder.com/300x450/1a1a1a/ffffff?text=No+Image";
								}
								<img src="@imageUrl" alt="@movie.Title" loading="lazy"
									 onerror="this.src='https://via.placeholder.com/300x450/1a1a1a/ffffff?text=No+Image'">
								<div class="recommended-overlay">
									<a href="@Url.Action("Details", "Movies", new { id = movie.Id })" class="recommended-view-btn">
										<i class="fas fa-info-circle"></i>
										Xem Chi Ti·∫øt
									</a>
								</div>
								<div class="recommended-rating">
									<i class="fas fa-star"></i> @movie.Rating.ToString("F1")
								</div>
							</div>
							<div class="recommended-info movie-info-home">
								<span class="recommended-genre badge-genre-home">
									@(movie.Genres != null && movie.Genres.Any() ? movie.Genres.First().Name : "Ch∆∞a ph√¢n lo·∫°i")
								</span>
								<h3 class="recommended-title movie-title-home">@movie.Title</h3>
								<div class="recommended-meta">
									<div class="recommended-duration">
										<i class="fas fa-clock"></i>
										<span>@movie.RunningTime ph√∫t</span>
									</div>
									<span>@movie.ReleaseDate.Year</span>
								</div>
							</div>
						</div>
					}

				}

				else

				{
					<!-- Empty state khi kh√¥ng c√≥ phim ƒë·ªÅ xu·∫•t -->
					<div class="empty-state">
						<div class="empty-state-content">
							<i class="fas fa-film fa-3x text-muted mb-3"></i>
							<h4>Ch∆∞a c√≥ phim ƒë·ªÅ xu·∫•t</h4>
							<p>Hi·ªán t·∫°i ch∆∞a c√≥ phim n√†o ƒë∆∞·ª£c ƒë√°nh d·∫•u l√† ƒë·ªÅ xu·∫•t.</p>
							<a href="@Url.Action("Index", "Movies")" class="btn btn-primary">
								<i class="fas fa-search"></i> Xem t·∫•t c·∫£ phim
							</a>
						</div>
					</div>
				}
			</div>

			<!-- Th√™m n√∫t "Xem th√™m" v√†o ƒë√¢y, sau grid phim -->
			<button id="loadMoreRecommended" class="btn-load-more">
				<i class="fas fa-chevron-down"></i>
				<span>Xem th√™m</span>
			</button>
		</div>
	</div>

	<!-- Phim S·∫Øp Chi·∫øu - Full Width nh∆∞ Phim ƒë·ªÅ xu·∫•t -->
	
	<!-- Phim S·∫Øp Chi·∫øu - Thi·∫øt k·∫ø m·ªõi -->
	<div class="recommended-section-new">
		<div class="section-title-bar">
			<h2><i class="fas fa-film"></i> Phim S·∫Øp Chi·∫øu</h2>
			<a href="@Url.Action("Index", "Movies")" class="view-all-link">
				Xem t·∫•t c·∫£ <i class="fas fa-chevron-right"></i>
			</a>
		</div>

		<!-- B·ªô l·ªçc v√† s·∫Øp x·∫øp -->
		<div class="pagination-controls">
			<div class="sort-filter-controls">
				<div class="filter-group">
					<label class="filter-label">
						<i class="fas fa-calendar-alt"></i>
						<span>S·∫Øp x·∫øp theo</span>
					</label>
					<select id="comingSoonSort" class="pagination-select">
						<option value="releaseDate-asc">Ng√†y chi·∫øu g·∫ßn nh·∫•t</option>
						<option value="releaseDate-desc">Ng√†y chi·∫øu xa nh·∫•t</option>
						<option value="title-asc">T√™n A-Z</option>
						<option value="rating-desc">ƒê√°nh gi√° cao nh·∫•t</option>
					</select>
				</div>

				<div class="filter-group">
					<label class="filter-label">
						<i class="fas fa-theater-masks"></i>
						<span>Th·ªÉ lo·∫°i</span>
					</label>
					<select id="comingSoonGenre" class="pagination-select">
						<option value="all">T·∫•t c·∫£ th·ªÉ lo·∫°i</option>
						<option value="h√†nh ƒë·ªông">H√†nh ƒë·ªông</option>
						<option value="t√¨nh c·∫£m">T√¨nh c·∫£m</option>
						<option value="kinh d·ªã">Kinh d·ªã</option>
						<option value="h√†i">H√†i</option>
						<option value="khoa h·ªçc vi·ªÖn t∆∞·ªüng">Khoa h·ªçc vi·ªÖn t∆∞·ªüng</option>
						<option value="phi√™u l∆∞u">Phi√™u l∆∞u</option>
					</select>
				</div>

				<div class="filter-group">
					<label class="filter-label">
						<i class="fas fa-eye"></i>
						<span>Hi·ªÉn th·ªã</span>
					</label>
					<select id="comingSoonPageSize" class="pagination-select">
						<option value="4">4 phim</option>
						<option value="8">8 phim</option>
						<option value="12">12 phim</option>
					</select>
				</div>
			</div>

			<!-- Th√¥ng tin ph√¢n trang -->
			<div class="pagination-info" id="comingSoonInfo">
				<div class="info-content">
					<i class="fas fa-info-circle"></i>
					<span>Trang 1 / 1 (0 phim)</span>
				</div>
			</div>
		</div>

		
		<div class="recommended-grid">
			@if (Model?.ComingSoonMovies != null && Model.ComingSoonMovies.Any())
			{
				foreach (var movie in Model.ComingSoonMovies.Take(4))
				{
					<div class="recommended-item">
						<div class="recommended-poster">
							@{
								string imageUrl = movie.PrimaryImageUrl ?? movie.ImageUrl;
								if (string.IsNullOrEmpty(imageUrl) && movie.Images != null && movie.Images.Any())
								{
									var primaryImage = movie.Images.FirstOrDefault(img => img.IsPrimary) ?? movie.Images.First();
									imageUrl = primaryImage?.ImageUrl ?? "";
								}
								imageUrl = imageUrl ?? "https://via.placeholder.com/300x450/1a1a1a/ffffff?text=No+Image";
							}
							<img src="@imageUrl" alt="@movie.Title" loading="lazy"
								 onerror="this.src='https://via.placeholder.com/300x450/1a1a1a/ffffff?text=No+Image'">

							
							<div class="recommended-overlay">
								<a href="@Url.Action("Details", "Movies", new { id = movie.Id })" class="recommended-view-btn">
									<i class="fas fa-info-circle"></i>
									Xem Chi Ti·∫øt
								</a>
							</div>

							<!-- Ng√†y ph√°t h√†nh -->
							<div class="recommended-release-date">
								<i class="fas fa-calendar-alt"></i> @movie.ReleaseDate.ToString("dd/MM/yyyy")
							</div>

							<!-- ƒê√°nh gi√° sao -->
							@if (movie.Rating > 0)
							{
								<div class="recommended-rating">
									<i class="fas fa-star"></i> @movie.Rating.ToString("F1")
								</div>
							}
						</div>

						<!-- Th√¥ng tin phim -->
						<div class="recommended-info">
							<!-- Th·ªÉ lo·∫°i -->
							<span class="recommended-genre">
								@(movie.Genres != null && movie.Genres.Any() ? movie.Genres.First().Name : "Ch∆∞a ph√¢n lo·∫°i")
							</span>

							<!-- Ti√™u ƒë·ªÅ -->
							<h3 class="recommended-title">@movie.Title</h3>

							<!-- Th√¥ng tin th√™m -->
							<div class="recommended-meta">
								<div class="recommended-duration">
									<i class="fas fa-clock"></i>
									<span>@movie.RunningTime ph√∫t</span>
								</div>
								<span>@movie.ReleaseDate.Year</span>
							</div>
						</div>
					</div>
				}
			}
			else
			{
				<!-- Tr·∫°ng th√°i tr·ªëng -->
				<div class="empty-state">
					<div class="empty-state-content">
						<i class="fas fa-calendar-alt fa-3x text-muted mb-3"></i>
						<h4>Ch∆∞a c√≥ phim s·∫Øp chi·∫øu</h4>
						<p>Hi·ªán t·∫°i ch∆∞a c√≥ phim n√†o trong tr·∫°ng th√°i s·∫Øp chi·∫øu.</p>
						<a href="@Url.Action("Index", "Movies")" class="btn btn-primary">
							<i class="fas fa-search"></i> Xem t·∫•t c·∫£ phim
						</a>
					</div>
				</div>
			}
		</div>

		<!-- N√∫t xem th√™m -->
		<button id="loadMoreComingSoon" class="btn-load-more">
			<i class="fas fa-chevron-down"></i>
			<span>Xem th√™m</span>
		</button>
	</div>

	<!-- Khuy·∫øn M√£i - Independent Section -->
	<div class="recommended-section-new">
		<div class="section-title-bar">
			<h2><i class="fas fa-tags"></i> Khuy·∫øn M√£i</h2>
			<a href="@Url.Action("Index", "Promotions")" class="view-all-link">
				Xem t·∫•t c·∫£ <i class="fas fa-chevron-right"></i>
			</a>
		</div>
		<div class="recommended-content">
			<div class="recommended-grid">
				@if (Model?.Promotions != null && Model.Promotions.Any())
				{
					foreach (var promo in Model.Promotions.Take(4))
					{
						<div class="recommended-item">
							<div class="recommended-poster">
								<img src="@promo.ImageUrl" alt="@promo.Title"
									 onerror="this.src='https://via.placeholder.com/300x450/df2144/ffffff?text=Khuy·∫øn+M√£i'">
								<div class="recommended-overlay">
									<a href="@Url.Action("Index", "Promotions")" class="recommended-view-btn">
										<i class="fas fa-tag"></i>
										Xem Chi Ti·∫øt
									</a>
								</div>
								
								<div class="recommended-promotion-badge">
									<i class="fas fa-percentage"></i> Khuy·∫øn M√£i
								</div>
							</div>
							<div class="recommended-info">
								<span class="recommended-genre">
									<i class="fas fa-calendar-alt"></i>
									@promo.StartDate.ToString("dd/MM") - @promo.EndDate.ToString("dd/MM/yyyy")
								</span>
								<h3 class="recommended-title">@promo.Title</h3>
								<div class="recommended-meta">
									<div class="recommended-description">
										<i class="fas fa-info-circle"></i>
										<span>@(promo.Description.Length > 50 ? promo.Description.Substring(0, 50) + "..." : promo.Description)</span>
									</div>
								</div>
							</div>
						</div>
					}
				}
				else
				{
					<!-- D·ªØ li·ªáu m·∫´u khi kh√¥ng c√≥ khuy·∫øn m√£i -->
					<div class="recommended-item">
						<div class="recommended-poster">
							<img src="https://via.placeholder.com/300x450/df2144/ffffff?text=2+1" alt="Mua 2 t·∫∑ng 1">
							<div class="recommended-overlay">
								<a href="@Url.Action("Index", "Promotions")" class="recommended-view-btn">
									<i class="fas fa-tag"></i>
									Xem Chi Ti·∫øt
								</a>
							</div>
							<div class="recommended-promotion-badge">
								<i class="fas fa-gift"></i> Mua 2 T·∫∑ng 1
							</div>
						</div>
						<div class="recommended-info">
							<span class="recommended-genre">
								<i class="fas fa-calendar-alt"></i>
								01/06 - 30/06/2024
							</span>
							<h3 class="recommended-title">Mua 2 t·∫∑ng 1 v√© xem phim</h3>
							<div class="recommended-meta">
								<div class="recommended-description">
									<i class="fas fa-info-circle"></i>
									<span>Mua 2 v√© ƒë∆∞·ª£c t·∫∑ng 1 v√© mi·ªÖn ph√≠ c√πng ng√†y...</span>
								</div>
							</div>
						</div>
					</div>
					<div class="recommended-item">
						<div class="recommended-poster">
							<img src="https://via.placeholder.com/300x450/df2144/ffffff?text=50%" alt="Gi·∫£m gi√°">
							<div class="recommended-overlay">
								<a href="@Url.Action("Index", "Promotions")" class="recommended-view-btn">
									<i class="fas fa-tag"></i>
									Xem Chi Ti·∫øt
								</a>
							</div>
							<div class="recommended-promotion-badge">
								<i class="fas fa-percentage"></i> Gi·∫£m 50%
							</div>
						</div>
						<div class="recommended-info">
							<span class="recommended-genre">
								<i class="fas fa-calendar-alt"></i>
								15/06 - 15/07/2024
							</span>
							<h3 class="recommended-title">Gi·∫£m 50% combo b·∫Øp n∆∞·ªõc</h3>
							<div class="recommended-meta">
								<div class="recommended-description">
									<i class="fas fa-info-circle"></i>
									<span>Gi·∫£m gi√° 50% combo v√†o th·ª© 3 v√† th·ª© 4...</span>
								</div>
							</div>
						</div>
					</div>
					<div class="recommended-item">
						<div class="recommended-poster">
							<img src="https://via.placeholder.com/300x450/df2144/ffffff?text=VIP" alt="Th√†nh vi√™n">
							<div class="recommended-overlay">
								<a href="@Url.Action("Index", "Promotions")" class="recommended-view-btn">
									<i class="fas fa-tag"></i>
									Xem Chi Ti·∫øt
								</a>
							</div>
							<div class="recommended-promotion-badge">
								<i class="fas fa-crown"></i> VIP
							</div>
						</div>
						<div class="recommended-info">
							<span class="recommended-genre">
								<i class="fas fa-calendar-alt"></i>
								01/06 - 31/12/2024
							</span>
							<h3 class="recommended-title">∆Øu ƒë√£i th√†nh vi√™n m·ªõi</h3>
							<div class="recommended-meta">
								<div class="recommended-description">
									<i class="fas fa-info-circle"></i>
									<span>ƒêƒÉng k√Ω m·ªõi nh·∫≠n 2 v√© v√† combo mi·ªÖn ph√≠...</span>
								</div>
							</div>
						</div>
					</div>
					<div class="recommended-item">
						<div class="recommended-poster">
							<img src="https://via.placeholder.com/300x450/df2144/ffffff?text=BDAY" alt="Sinh nh·∫≠t">
							<div class="recommended-overlay">
								<a href="@Url.Action("Index", "Promotions")" class="recommended-view-btn">
									<i class="fas fa-tag"></i>
									Xem Chi Ti·∫øt
								</a>
							</div>
							<div class="recommended-promotion-badge">
								<i class="fas fa-birthday-cake"></i> Sinh Nh·∫≠t
							</div>
						</div>
						<div class="recommended-info">
							<span class="recommended-genre">
								<i class="fas fa-calendar-alt"></i>
								Quanh nƒÉm
							</span>
							<h3 class="recommended-title">∆Øu ƒë√£i sinh nh·∫≠t</h3>
							<div class="recommended-meta">
								<div class="recommended-description">
									<i class="fas fa-info-circle"></i>
									<span>Mi·ªÖn ph√≠ 1 v√© trong th√°ng sinh nh·∫≠t...</span>
								</div>
							</div>
						</div>
					</div>
				}
			</div>
		</div>
	</div>
</div>
</div>

@section Scripts {
	<script>
		// Truy·ªÅn d·ªØ li·ªáu phim t·ª´ Model v√†o JavaScript
		window.heroMoviesData = @Html.Raw(JsonSerializer.Serialize((Model?.HeroMovies ?? new List<MovieViewModel>()).Select(movie => new
			{

				id = movie.Id,

				title = movie.Title,

				titleVn = movie.Director ?? "ƒê·∫°o di·ªÖn",

				plot = movie.Content ?? "Ch∆∞a c√≥ th√¥ng tin n·ªôi dung.",

				genre = (movie.Genres != null && movie.Genres.Any()) ? string.Join(", ", movie.Genres.Select(g => g.Name)) : "Ch∆∞a ph√¢n lo·∫°i",

				duration = $"{movie.RunningTime} ph√∫t",

				background = GetMovieImageUrl(movie),

				trailerUrl = movie.TrailerUrl ?? ""

			})));

		// üîç DEBUG: Ki·ªÉm tra data source
		console.log('üìä MOVIE DATA SOURCE CHECK:');
		console.log('Total movies:', window.heroMoviesData?.length || 0);

		if (window.heroMoviesData && window.heroMoviesData.length > 0) {
			const firstMovie = window.heroMoviesData[0];
			console.log('First movie ID:', firstMovie.id);
			console.log('First movie title:', firstMovie.title);

			// üñºÔ∏è DEBUG: Ki·ªÉm tra background URLs
			console.log('üñºÔ∏è BACKGROUND URL CHECK:');
			window.heroMoviesData.forEach((movie, index) => {
				console.log(`${index + 1}. ${movie.title} -> ${movie.background}`);
			});

			// Ki·ªÉm tra xem c√≥ ph·∫£i data t·ª´ API kh√¥ng
			const isFromAPI = firstMovie.id && firstMovie.id.includes('00000000-0000-0000-0000-');
			const isFromFallback = firstMovie.id && (firstMovie.id === '1' || firstMovie.id === '2' || firstMovie.id === '3');

			if (isFromAPI) {
				console.log('‚úÖ USING API DATA - Backend working!');
				console.log('üé¨ Movies from database:', window.heroMoviesData.map(m => m.title));
			} else if (isFromFallback) {
				console.log('‚ö†Ô∏è USING FALLBACK DATA - API might be down');
				console.log('üé¨ Fallback movies:', window.heroMoviesData.map(m => m.title));
			} else {
				console.log('‚ùì UNKNOWN DATA SOURCE');
				console.log('üé¨ All movies:', window.heroMoviesData);
			}
		} else {
			console.log('‚ùå NO MOVIE DATA AVAILABLE');
		}

		window.movieUrls = {
			moviesIndex: '@Url.Action("Index", "Movies")',
			movieDetails: '@Url.Action("Details", "Movies")'
		};


		document.addEventListener('DOMContentLoaded', function () {
			const userDropdown = document.getElementById('userDropdown');
			const dropdownMenu = document.querySelector('.dropdown-menu');

			if (userDropdown && dropdownMenu) {

				userDropdown.addEventListener('click', function (e) {
					e.preventDefault();
					e.stopPropagation();


					const isShowing = dropdownMenu.classList.contains('show');

					if (isShowing) {
						dropdownMenu.classList.remove('show');
						userDropdown.setAttribute('aria-expanded', 'false');
					} else {
						dropdownMenu.classList.add('show');
						userDropdown.setAttribute('aria-expanded', 'true');
					}
				});


				userDropdown.addEventListener('click', function (e) {
					e.stopPropagation();
				}, true);


				document.addEventListener('click', function (e) {
					if (!userDropdown.contains(e.target) && !dropdownMenu.contains(e.target)) {
						dropdownMenu.classList.remove('show');
						userDropdown.setAttribute('aria-expanded', 'false');
					}
				});


				document.addEventListener('keydown', function (e) {
					if (e.key === 'Escape' && dropdownMenu.classList.contains('show')) {
						dropdownMenu.classList.remove('show');
						userDropdown.setAttribute('aria-expanded', 'false');
						userDropdown.focus();
					}
				});
			}
		});


		document.addEventListener('DOMContentLoaded', function () {
			const searchInput = document.getElementById('movieSearchInput');
			const searchButton = document.getElementById('searchButton');


			searchButton?.addEventListener('click', function () {
				performSearch();
			});


			searchInput?.addEventListener('keypress', function (e) {
				if (e.key === 'Enter') {
					performSearch();
				}
			});

			async function performSearch() {
				const keyword = searchInput.value.trim();


				const searchUrl = '@Url.Action("Search", "Movies")' + (keyword ? `?keyword=${encodeURIComponent(keyword)}` : '');
				window.location.href = searchUrl;
			}
		});


		if (window.location.search.includes('debug=true')) {
			document.addEventListener('DOMContentLoaded', function() {
				const testButton = document.createElement('button');
				testButton.textContent = 'TEST NAVIGATE TO MOVIE';
				testButton.style.position = 'fixed';
				testButton.style.top = '10px';
				testButton.style.right = '10px';
				testButton.style.zIndex = '99999';
				testButton.style.background = 'red';
				testButton.style.color = 'white';
				testButton.style.padding = '10px';
				testButton.style.border = 'none';
				testButton.style.cursor = 'pointer';
				
				testButton.addEventListener('click', function() {
					console.log('üß™ Test button clicked');
					window.location.href = '/Movies/Details/11111111-1111-1111-1111-0000000000a1';
				});
				
				document.body.appendChild(testButton);
			});
		}
	</script>
	<script src="~/js/homepage.js"></script>
<script src="~/js/homepage-debug.js"></script>
	<script src="~/js/movie-card-debug.js"></script>
	<script src="~/js/dropdown-debug.js"></script>
	<script src="~/js/force-navigation.js"></script>
	<script src="~/js/pagination-debug.js"></script>
}

@functions {
	private string GetMovieImageUrl(MovieViewModel movie)
	{
		return movie.PrimaryImageUrl

			?? movie.ImageUrl
			?? movie.Images?.FirstOrDefault(img => img.IsPrimary)?.ImageUrl
			?? movie.Images?.FirstOrDefault()?.ImageUrl
			?? "https://via.placeholder.com/300x450/1a1a1a/ffffff?text=No+Image";
	}
	private string GetMovieDescription(string? content)

	{

		if (string.IsNullOrEmpty(content)) return "Ch∆∞a c√≥ th√¥ng tin n·ªôi dung.";

		return content.Length > 150 ? content[..150] + "..." : content;

	}
}
