@using System.Security.Claims
@using System.Text.Json
@model UI.Models.HomeViewModel
@{
    ViewData["Title"] = "Trang Chủ - Cinema City";
}

@section Styles {
    <link rel="stylesheet" href="~/css/HomePage/base.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/HomePage/layout.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/HomePage/header.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/HomePage/hero.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/HomePage/button.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/HomePage/responsive.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/HomePage/banner.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/HomePage/movie-poster-overlay.css" asp-append-version="true" />
    <style>
        /* Movie Cards Hover Effect Styles */
        .movie-card {
            position: relative;
            cursor: pointer;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border-radius: 8px;
            overflow: hidden;
        }

        .movie-card:hover {
            transform: scale(1.05);
        }

        /* Movie Poster */
        .movie-poster {
            position: relative;
            aspect-ratio: 2/3;
            border-radius: 8px;
            overflow: hidden;
        }

        .movie-poster img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: opacity 0.3s ease;
        }

        /* Hover Overlay - Initially Hidden */
        .movie-card .movie-poster-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(0deg, rgba(0, 0, 0, 0.90) 0%, rgba(0, 0, 0, 0.3) 100%);
            border-radius: 8px;
            padding: 16px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 10;
        }

        /* Show overlay on hover */
        .movie-card:hover .movie-poster-overlay {
            opacity: 1;
            visibility: visible;
        }

        /* Hide original image on hover */
        .movie-card:hover .movie-poster img {
            opacity: 0.3;
        }

        /* Featured card always shows overlay */
        .movie-card.featured .movie-poster-overlay {
            opacity: 1;
            visibility: visible;
            background: linear-gradient(0deg, rgba(0, 0, 0, 0.80) 0%, transparent 100%), url('https://image.tmdb.org/t/p/w500/NNxYkU70HPurnNCSiCjYAmacwm.jpg') lightgray 50% / cover no-repeat;
        }

        .movie-card.featured .movie-poster img {
            display: none;
        }

        .movie-card.featured .movie-meta,
        .movie-card.featured .movie-name {
            opacity: 1;
        }

        /* Overlay Content */
        .overlay-content {
            color: white;
            text-align: center;
            padding: 0 8px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 12px;
            height: 100%;
            position: relative;
        }

        .overlay-content h3 {
            font-size: 18px;
            font-weight: 700;
            margin: 0;
            color: white;
        }

        .overlay-content p {
            font-size: 11px;
            line-height: 1.4;
            margin: 0;
            text-align: justify;
            color: rgba(255, 255, 255, 0.9);
        }

        .overlay-cursor {
            position: absolute;
            top: 8px;
            right: 8px;
            color: white;
            font-size: 20px;
            opacity: 0.7;
        }

        .overlay-details {
            display: flex;
            justify-content: space-between;
            margin-top: auto;
            gap: 10px;
        }

        .detail-col {
            display: flex;
            flex-direction: column;
            gap: 4px;
            text-align: center;
            flex: 1;
        }

        .detail-label {
            font-size: 12px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.8);
        }

        .detail-value {
            font-size: 10px;
            font-weight: 400;
            color: white;
        }

        /* Hide meta and name on hover for non-featured cards */
        .movie-card:not(.featured):hover .movie-meta,
        .movie-card:not(.featured):hover .movie-name {
            opacity: 0;
        }
        
        /* Styles cho nút profile */
        .user-profile {
            display: flex;
            align-items: center;
            margin-right: 20px;
            position: relative;
        }
        
        .btn-profile {
            display: flex;
            align-items: center;
            gap: 8px;
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 8px 16px;
            text-decoration: none;
            color: white;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .btn-profile:hover {
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
        }
        
        .btn-profile i {
            font-size: 18px;
        }
        
        /* Dropdown styles */
        .dropdown {
            position: relative;
        }
        
        .dropdown-toggle {
            position: relative;
        }
        
        .dropdown-toggle::after {
            display: none;
        }
        
        .dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 10px;
            background-color: #1a1a1a;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            min-width: 200px;
            padding: 8px 0;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
        }
        
        .dropdown-menu.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        .dropdown-item {
            display: flex;
            align-items: center;
            padding: 10px 20px;
            color: rgba(255, 255, 255, 0.9);
            text-decoration: none;
            transition: all 0.2s ease;
            background: none;
            border: none;
            width: 100%;
            text-align: left;
            font-size: 14px;
        }
        
        .dropdown-item:hover {
            background-color: rgba(255, 255, 255, 0.05);
            color: white;
            padding-left: 24px;
        }
        
        .dropdown-item i {
            width: 20px;
            margin-right: 8px;
            text-align: center;
        }
        
        .dropdown-divider {
            margin: 8px 0;
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        .dropdown-item.text-danger {
            color: #df2144;
        }
        
        .dropdown-item.text-danger:hover {
            background-color: rgba(223, 33, 68, 0.1);
            color: #ff3355;
        }
        
        /* User info in dropdown */
        .dropdown-header {
            text-align: center;
            padding: 15px 20px;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 12px 12px 0 0;
        }
        
        .user-info {
            color: white;
        }
        
        .user-info i {
            color: #df2144;
            margin-bottom: 10px;
        }
        
        .user-name {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .user-email {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }
        
        /* Responsive */
        @@media (max-width: 768px) {
            .d-none.d-md-inline {
                display: none !important;
            }
            
            .btn-profile {
                padding: 8px 12px;
            }
            
            .dropdown-menu {
                min-width: 180px;
            }
        }
        
        /* Auth buttons styles */
        .auth-buttons {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-left: 0;
        }
        
        .btn-register,
        .btn-login {
            padding: 8px 20px !important;
            border-radius: 20px !important;
            text-decoration: none;
            font-weight: 500 !important;
            font-size: 14px !important;
            transition: all 0.3s ease;
            white-space: nowrap;
            min-width: auto !important;
        }
        
        .btn-register {
            background-color: transparent !important;
            color: white !important;
            border: 1px solid rgba(255, 255, 255, 0.3) !important;
        }
        
        .btn-register:hover {
            background-color: rgba(255, 255, 255, 0.1) !important;
            border-color: rgba(255, 255, 255, 0.5) !important;
            color: white;
        }
        
        .btn-login {
            background-color: #df2144 !important;
            color: white !important;
            border: 1px solid #df2144 !important;
        }
        
        .btn-login:hover {
            background-color: #c01b3a !important;
            border-color: #c01b3a !important;
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(223, 33, 68, 0.3);
        }
        
        /* Ensure nav layout stays consistent */
        .nav-left {
            display: flex;
            align-items: center;
            gap: 20px;
            flex: 1;
        }
        
        .nav-center {
            display: flex;
            align-items: center;
            justify-content: center;
            flex: 0 0 auto;
        }
        
        .nav-right {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            flex: 1;
        }
        
        /* Loading styles */
        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 400px;
            color: white;
            text-align: center;
        }
        
        .loading-spinner {
            color: #df2144;
            margin-bottom: 20px;
        }
        
        .loading-text {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 10px;
            color: white;
        }
        
        .loading-subtext {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .loading-grid {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 300px;
            width: 100%;
        }
        
        .loading-card {
            text-align: center;
            color: white;
        }
        
        .loading-card .loading-spinner {
            margin-bottom: 15px;
        }
        
        .loading-card .loading-text {
            font-size: 18px;
            font-weight: 500;
        }
        
        /* Auth Modal Styles */
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }
        
        .auth-modal {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        
        .auth-modal .modal-header {
            background: linear-gradient(135deg, #df2144 0%, #c01b3a 100%);
            border-bottom: none;
            padding: 20px 30px;
        }
        
        .auth-modal .modal-title {
            color: white;
            font-weight: 700;
            font-size: 24px;
            margin: 0;
        }
        
        .auth-modal .btn-close-white {
            filter: brightness(0) invert(1);
            opacity: 0.8;
        }
        
        .auth-modal .btn-close-white:hover {
            opacity: 1;
        }
        
        .auth-modal .modal-body {
            padding: 30px;
            color: white;
        }
        
        .auth-subtitle {
            color: rgba(255, 255, 255, 0.7);
            font-size: 16px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        /* Form Styles */
        .auth-modal .form-label {
            color: rgba(255, 255, 255, 0.9);
            font-weight: 500;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .auth-modal .form-control {
            background-color: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            padding: 12px 16px;
            font-size: 15px;
            border-radius: 10px;
            transition: all 0.3s ease;
        }
        
        .auth-modal .form-control:focus {
            background-color: rgba(255, 255, 255, 0.08);
            border-color: #df2144;
            box-shadow: 0 0 0 3px rgba(223, 33, 68, 0.2);
            color: white;
        }
        
        .auth-modal .form-control::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }
        
        .auth-modal .input-group .btn {
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.7);
        }
        
        .auth-modal .input-group .btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
        }
        
        .auth-modal .form-check-input {
            background-color: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.3);
        }
        
        .auth-modal .form-check-input:checked {
            background-color: #df2144;
            border-color: #df2144;
        }
        
        .auth-modal .form-check-label {
            color: rgba(255, 255, 255, 0.8);
        }
        
        /* Button Styles */
        .auth-btn {
            padding: 14px 28px;
            font-weight: 600;
            font-size: 16px;
            border-radius: 10px;
            border: none;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .auth-modal .btn-primary {
            background: linear-gradient(135deg, #df2144 0%, #c01b3a 100%);
            box-shadow: 0 4px 15px rgba(223, 33, 68, 0.3);
        }
        
        .auth-modal .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(223, 33, 68, 0.4);
        }
        
        .auth-modal .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #218838 100%);
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }
        
        .auth-modal .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }
        
        /* Footer Links */
        .auth-footer {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .auth-link {
            color: #df2144;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .auth-link:hover {
            color: #ff3355;
            text-decoration: underline;
        }
        
        /* Select dropdown */
        .auth-modal select.form-control {
            cursor: pointer;
        }
        
        .auth-modal select.form-control option {
            background-color: #2d2d2d;
            color: white;
        }
        
        /* Date input */
        .auth-modal input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(0.8);
            cursor: pointer;
        }
        
        /* Textarea */
        .auth-modal textarea.form-control {
            resize: vertical;
            min-height: 60px;
        }
        
        /* Animation */
        .modal.fade .modal-dialog {
            transform: scale(0.9);
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .modal.show .modal-dialog {
            transform: scale(1);
            opacity: 1;
        }
    </style>
}

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

<div class="cinema-homepage">
    <!-- Hero Section -->
    <div class="hero-section" id="heroSection">
        <!-- Navigation -->
        <div class="hero-nav">
            <div class="nav-content">
                <div class="nav-left">
                    <div class="brand">
                        <div class="brand-content">
                            <div class="brand-header">
                                <span class="brand-name">Cinema City</span>
                                <div class="brand-logo"></div>
                            </div>
                            <div class="brand-subtitle">Rạp chiếu phim hiện đại</div>
                        </div>
                    </div>
                    <div class="search-box">
                        <input type="text" placeholder="Tìm kiếm phim..." class="search-input">
                        <i class="fas fa-search search-icon"></i>
                    </div>
                </div>
                <div class="nav-center">
                    <div class="nav-links">
                        <a href="#" class="nav-link">Giới thiệu</a>
                        <a href="@Url.Action("Index", "Events")" class="nav-link">
                            <span>Sự kiện</span>
                            <i class="fas fa-chevron-down"></i>
                        </a>
                        <a href="@Url.Action("Index", "Products")" class="nav-link">
                            <span>Sản phẩm</span>
                            <i class="fas fa-chevron-down"></i>
                        </a>
                        <a href="@Url.Action("Index", "Movies")" class="nav-link">
                            <span>Phim</span>
                            <i class="fas fa-chevron-down"></i>
                        </a>
                    </div>
                </div>
                <div class="nav-right">
                    <div class="divider"></div>
                    @if (User.Identity?.IsAuthenticated == true)
                    {
                        <div class="user-profile">
                            <div class="dropdown">
                                <button class="btn-profile dropdown-toggle" type="button" id="userDropdown">
                                    <i class="fas fa-user-circle"></i>
                                    @if (ViewContext.HttpContext.User.Identity?.Name?.Length > 10)
                                    {
                                        <span class="d-none d-md-inline">@ViewContext.HttpContext.User.Identity.Name.Substring(0, 10)...</span>
                                    }
                                    else
                                    {
                                        <span class="d-none d-md-inline">@ViewContext.HttpContext.User.Identity?.Name</span>
                                    }
                                    <i class="fas fa-chevron-down ms-2"></i>
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                                    <li class="dropdown-header">
                                        <div class="user-info">
                                            <i class="fas fa-user-circle fa-2x mb-2"></i>
                                            <div class="user-name">@ViewContext.HttpContext.User.Identity?.Name</div>
                                            <div class="user-email">@ViewContext.HttpContext.User.FindFirst(ClaimTypes.Email)?.Value</div>
                                        </div>
                                    </li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li>
                                        <a class="dropdown-item" href="@Url.Action("Profile", "Account", new { area = "UserManagement" })">
                                            <i class="fas fa-user-edit"></i>
                                            Chỉnh sửa thông tin
                                        </a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item" href="@Url.Action("Index", "Dashboard")">
                                            <i class="fas fa-tachometer-alt"></i>
                                            Dashboard
                                        </a>
                                    </li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li>
                                        <form asp-action="Logout" asp-controller="Account" method="post" class="m-0">
                                            <button type="submit" class="dropdown-item text-danger">
                                                <i class="fas fa-sign-out-alt"></i>
                                                Đăng xuất
                                            </button>
                                        </form>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    }
                    else
                    {
                        <div class="auth-buttons">
                            <a href="#" class="btn-register" data-bs-toggle="modal" data-bs-target="#registerModal">Đăng ký</a>
                            <a href="#" class="btn-login" data-bs-toggle="modal" data-bs-target="#loginModal">Đăng nhập</a>
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Movie Content -->
        <div class="movie-content" id="movieContent">
            @if (Model?.FeaturedMovie != null)
            {
                <div class="movie-info">
                    <div class="movie-header">
                        <h1 class="movie-title" id="movieTitle">@Model.FeaturedMovie.Title</h1>
                        <p class="movie-title-vn" id="movieTitleVn">@(Model.FeaturedMovie.Director ?? "Đạo diễn")</p>
                    </div>
                    
                    <div class="movie-details">
                        <div class="plot-section">
                            <h3>Tóm tắt nội dung</h3>
                            <p id="moviePlot">
                                @(Model.FeaturedMovie.Content ?? "Chưa có thông tin nội dung.")
                            </p>
                        </div>

                        <div class="genre-section">
                            <h3>Thể loại</h3>
                            <p id="movieGenre">@(Model.FeaturedMovie.Genres != null && Model.FeaturedMovie.Genres.Any() ? string.Join(", ", Model.FeaturedMovie.Genres) : "Chưa phân loại")</p>
                        </div>

                        <div class="ratings-section">
                            <div class="rating-item">
                                <i class="fas fa-clock"></i>
                                <span id="duration">@Model.FeaturedMovie.RunningTime phút</span>
                            </div>
                        </div>

                        <div class="action-buttons">
                            <button class="btn-primary" onclick="bookTickets()">
                                <i class="fas fa-ticket-alt"></i>
                                Đặt vé ngay
                            </button>
                            <button class="btn-secondary" onclick="showMovieInfo()">
                                <i class="fas fa-info-circle"></i>
                                Thông tin phim
                            </button>
                        </div>
                    </div>
                </div>
            }
            else
            {
                <div class="movie-info">
                    <div class="loading-container">
                        <div class="loading-spinner">
                            <i class="fas fa-spinner fa-spin fa-3x"></i>
                        </div>
                        <h2 class="loading-text">Đang tải dữ liệu phim...</h2>
                        <p class="loading-subtext">Vui lòng đợi trong giây lát</p>
                    </div>
                </div>
            }

            <div class="movie-controls">
                <div class="control-left">
                    <button class="nav-btn" onclick="previousMovie()">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                </div>
                
                <div class="pagination-dots" id="paginationDots">
                    @if (Model?.HeroMovies != null && Model.HeroMovies.Any())
                    {
                        for (int i = 0; i < Model.HeroMovies.Count; i++)
                        {
                            <span class="dot @(i == 0 ? "active" : "")"></span>
                        }
                    }
                    else
                    {
                        <span class="dot active"></span>
                    }
                </div>

                <div class="control-right">
                    <button class="nav-btn" onclick="nextMovie()">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Advanced Search Section -->
    <div class="search-section">
        <div class="search-header" onclick="toggleSearch()">
            <i class="fas fa-chevron-up search-toggle"></i>
            <h2>Tìm kiếm nâng cao phim và TV series</h2>
        </div>
        
        <div class="search-form" id="searchForm">
            <div class="form-grid">
                <div class="form-column">
                    <div class="form-group">
                        <label>Năm phát hành đến</label>
                        <select class="form-select">
                            <option>Chưa chọn</option>
                            <option>2024</option>
                            <option>2023</option>
                            <option>2022</option>
                        </select>
                    </div>                  
                </div>

                <div class="form-column">
                    <div class="form-group">
                        <label>Năm phát hành từ</label>
                        <select class="form-select">
                            <option>Chưa chọn</option>
                            <option>1990</option>
                            <option>2000</option>
                            <option>2010</option>
                        </select>
                    </div>

                </div>

                <div class="form-column">
                    <div class="form-group">
                        <label>Thể loại</label>
                        <select class="form-select">
                            <option>Tất cả</option>
                            <option>Hành động</option>
                            <option>Tình cảm</option>
                            <option>Kinh dị</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Chất lượng</label>
                        <select class="form-select">
                            <option>Tất cả</option>
                            <option>4K</option>
                            <option>HD</option>
                            <option>Full HD</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Độ tuổi</label>
                        <select class="form-select">
                            <option>Tất cả</option>
                            <option>P</option>
                            <option>T13</option>
                            <option>T16</option>
                            <option>T18</option>
                        </select>
                    </div>
                </div>

                <div class="form-column">
                    <div class="form-group">
                        <label>Loại</label>
                        <select class="form-select">
                            <option>Tất cả</option>
                            <option>Phim lẻ</option>
                            <option>Phim bộ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Quốc gia</label>
                        <select class="form-select">
                            <option>Tất cả</option>
                            <option>Việt Nam</option>
                            <option>Mỹ</option>
                            <option>Hàn Quốc</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Diễn viên</label>
                        <input type="text" class="form-input" placeholder="Nhập tên diễn viên">
                    </div>
                    <div class="form-group">
                        <label>Đạo diễn</label>
                        <input type="text" class="form-input" placeholder="Nhập tên đạo diễn">
                    </div>
                </div>
            </div>

            <div class="form-bottom">
                <button class="btn-search">Áp dụng bộ lọc và tìm kiếm</button>
                
                <div class="sort-section">
                    <label>Sắp xếp</label>
                    <select class="form-select">
                        <option>Theo năm phát hành</option>
                        <option>Theo tên phim</option>
                    </select>
                </div>

                <div class="toggle-section">
                    <div class="toggle-item">
                        <span>Phụ đề</span>
                        <div class="toggle-switch active">
                            <div class="toggle-circle"></div>
                        </div>
                    </div>
                    <div class="toggle-item">
                        <span>Lồng tiếng</span>
                        <div class="toggle-switch">
                            <div class="toggle-circle"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recommended Movies Section -->
    <div class="recommended-section">
        <div class="section-header">
            <div class="nav-controls">
                <button class="nav-btn" onclick="slideMovies('left')">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <button class="nav-btn" onclick="slideMovies('right')">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            <h2>Phim đề xuất</h2>
        </div>

        <div class="movies-grid" id="moviesGrid">
            @if (Model?.RecommendedMovies != null && Model.RecommendedMovies.Any())
            {
                foreach (var movie in Model.RecommendedMovies)
                {
                    <div class="movie-card">
                        <div class="movie-poster">
                            @if (!string.IsNullOrEmpty(movie.PrimaryImageUrl))
                            {
                                <img src="@movie.PrimaryImageUrl" alt="@movie.Title" loading="lazy">
                            }
                            else if (!string.IsNullOrEmpty(movie.ImageUrl))
                            {
                                <img src="@movie.ImageUrl" alt="@movie.Title" loading="lazy">
                            }
                            else if (movie.Images != null && movie.Images.Any())
                            {
                                var primaryImage = movie.Images.FirstOrDefault(img => img.IsPrimary) ?? movie.Images.First();
                                <img src="@primaryImage.ImageUrl" alt="@movie.Title" loading="lazy">
                            }
                            else
                            {
                                <img src="https://via.placeholder.com/300x450/1a1a1a/ffffff?text=No+Image" alt="@movie.Title" loading="lazy">
                            }
                            <div class="movie-poster-overlay">
                                <div class="overlay-content">
                                    <h3>Tóm tắt nội dung</h3>
                                    <p>@(string.IsNullOrEmpty(movie.Content) ? "Chưa có thông tin nội dung." : (movie.Content.Length > 150 ? movie.Content.Substring(0, 150) + "..." : movie.Content))</p>
                                    <div class="overlay-details">
                                        <div class="detail-col">
                                            <span class="detail-label">Thể loại</span>
                                            <span class="detail-value">@(movie.Genres != null && movie.Genres.Any() ? string.Join(", ", movie.Genres) : "Chưa phân loại")</span>
                                        </div>
                                        <div class="detail-col">
                                            <span class="detail-label">Phiên bản</span>
                                            <span class="detail-value">@movie.Version</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="movie-meta">
                            <div class="meta-item">
                                <i class="fas fa-clock"></i>
                                <span>@movie.RunningTime phút</span>
                            </div>
                        </div>
                        <h3 class="movie-name">@movie.Title</h3>
                    </div>
                }
            }
            else
            {
                <div class="loading-grid">
                    <div class="loading-card">
                        <div class="loading-spinner">
                            <i class="fas fa-spinner fa-spin fa-2x"></i>
                        </div>
                        <p class="loading-text">Đang tải danh sách phim...</p>
                    </div>
                </div>
            }
        </div>

        <button class="view-all-btn" onclick="location.href='@Url.Action("Index", "Movies")'">
            <i class="fas fa-chevron-left"></i>
            <span>Xem tất cả</span>
        </button>
    </div>

    <!-- Featured Banner Section -->
    <div class="container">
        @if (Model?.FeaturedMovie != null)
        {
            <div class="featured-banner" @(Model.FeaturedMovie.PrimaryImageUrl != null ? $"style=\"background-image: url('{Model.FeaturedMovie.PrimaryImageUrl}');\"" : Model.FeaturedMovie.Images != null && Model.FeaturedMovie.Images.Any() ? $"style=\"background-image: url('{Model.FeaturedMovie.Images.FirstOrDefault(img => img.IsPrimary)?.ImageUrl ?? Model.FeaturedMovie.Images.First().ImageUrl}');\"" : "")>
                <div class="banner-content">
                    <div class="banner-info">
                        <div class="banner-header">
                            <h2 class="banner-title">@Model.FeaturedMovie.Title</h2>
                            <p class="banner-title-vn">@(Model.FeaturedMovie.ProductionCompany ?? "Nhà sản xuất")</p>
                        </div>
                        
                        <div class="banner-plot">
                            <h3>Tóm tắt nội dung</h3>
                            <p>@(string.IsNullOrEmpty(Model.FeaturedMovie.Content) ? "Chưa có thông tin nội dung." : Model.FeaturedMovie.Content)</p>
                        </div>

                        <div class="banner-genre">
                            <h3>Thể loại</h3>
                            <p>@(Model.FeaturedMovie.Genres != null && Model.FeaturedMovie.Genres.Any() ? string.Join(", ", Model.FeaturedMovie.Genres) : "Chưa phân loại")</p>
                        </div>

                        <div class="banner-ratings">
                            <div class="rating-item">
                                <i class="fas fa-clock"></i>
                                <span>@Model.FeaturedMovie.RunningTime phút</span>
                            </div>
                        </div>

                        <a href="@Url.Action("Details", "Movies", new { id = Model.FeaturedMovie.Id })" class="btn-banner">
                            Xem chi tiết phim
                        </a>
                    </div>
                </div>
            </div>
        }
        else
        {
            <div class="featured-banner">
                <div class="banner-content">
                    <div class="loading-container">
                        <div class="loading-spinner">
                            <i class="fas fa-spinner fa-spin fa-3x"></i>
                        </div>
                        <h2 class="loading-text">Đang tải thông tin phim nổi bật...</h2>
                    </div>
                </div>
            </div>
        }
    </div>
</div>

<!-- Login Modal -->
<div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content auth-modal">
            <div class="modal-header">
                <h5 class="modal-title" id="loginModalLabel">
                    <i class="fas fa-film me-2"></i>Chào mừng trở lại
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p class="auth-subtitle">Đăng nhập vào tài khoản rạp phim của bạn</p>
                
                <form id="loginForm" method="post">
                    @Html.AntiForgeryToken()
                    <div class="form-group mb-3">
                        <label class="form-label">
                            <i class="fas fa-user me-1"></i>Tên đăng nhập
                        </label>
                        <input type="text" name="username" class="form-control form-control-lg" placeholder="Nhập tên đăng nhập của bạn" required />
                        <span class="text-danger small" id="loginUsernameError"></span>
                    </div>

                    <div class="form-group mb-3">
                        <label class="form-label">
                            <i class="fas fa-lock me-1"></i>Mật khẩu
                        </label>
                        <div class="input-group">
                            <input type="password" name="password" class="form-control form-control-lg" placeholder="Nhập mật khẩu của bạn" required />
                            <button type="button" class="btn btn-outline-secondary toggle-password">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <span class="text-danger small" id="loginPasswordError"></span>
                    </div>

                    <div class="text-danger mb-3" id="loginError"></div>

                    <button type="submit" class="btn btn-primary btn-lg w-100 auth-btn">
                        <i class="fas fa-sign-in-alt me-2"></i>Đăng nhập
                    </button>

                    <div class="auth-footer mt-3">
                        <p class="text-center mb-2">
                            Chưa có tài khoản? 
                            <a href="#" class="auth-link" onclick="switchToRegister()">Tạo tài khoản ngay</a>
                        </p>
                        <p class="text-center">
                            <a href="#" class="auth-link small">Quên mật khẩu?</a>
                        </p>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Register Modal -->
<div class="modal fade" id="registerModal" tabindex="-1" aria-labelledby="registerModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content auth-modal">
            <div class="modal-header">
                <h5 class="modal-title" id="registerModalLabel">
                    <i class="fas fa-user-plus me-2"></i>Tạo tài khoản
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p class="auth-subtitle">Tham gia cộng đồng điện ảnh ngay hôm nay</p>
                
                <form id="registerForm" method="post">
                    @Html.AntiForgeryToken()
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label class="form-label">
                                    <i class="fas fa-user me-1"></i>Tên đăng nhập
                                </label>
                                <input type="text" name="username" class="form-control" placeholder="Chọn tên đăng nhập" required />
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label class="form-label">
                                    <i class="fas fa-envelope me-1"></i>Email
                                </label>
                                <input type="email" name="email" class="form-control" placeholder="Địa chỉ email của bạn" required />
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label class="form-label">
                                    <i class="fas fa-lock me-1"></i>Mật khẩu
                                </label>
                                <input type="password" name="password" class="form-control" placeholder="Tạo mật khẩu" required />
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label class="form-label">
                                    <i class="fas fa-lock me-1"></i>Xác nhận mật khẩu
                                </label>
                                <input type="password" name="confirmPassword" class="form-control" placeholder="Nhập lại mật khẩu" required />
                            </div>
                        </div>
                    </div>

                    <div class="form-group mb-3">
                        <label class="form-label">
                            <i class="fas fa-id-card me-1"></i>Họ và tên
                        </label>
                        <input type="text" name="fullName" class="form-control" placeholder="Họ và tên của bạn" required />
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label class="form-label">
                                    <i class="fas fa-phone me-1"></i>Số điện thoại
                                </label>
                                <input type="tel" name="phone" class="form-control" placeholder="Số điện thoại" />
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label class="form-label">
                                    <i class="fas fa-id-badge me-1"></i>CMND/CCCD
                                </label>
                                <input type="text" name="identityCard" class="form-control" placeholder="Số CMND/CCCD" />
                            </div>
                        </div>
                    </div>

                    <div class="form-group mb-3">
                        <label class="form-label">
                            <i class="fas fa-map-marker-alt me-1"></i>Địa chỉ
                        </label>
                        <textarea name="address" class="form-control" rows="2" placeholder="Địa chỉ của bạn"></textarea>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label class="form-label">
                                    <i class="fas fa-calendar me-1"></i>Ngày sinh
                                </label>
                                <input type="date" name="birthDate" class="form-control" />
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <label class="form-label">
                                    <i class="fas fa-venus-mars me-1"></i>Giới tính
                                </label>
                                <select name="gender" class="form-control">
                                    <option value="">Chọn giới tính</option>
                                    <option value="Nam">Nam</option>
                                    <option value="Nữ">Nữ</option>
                                    <option value="Khác">Khác</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="text-danger mb-3" id="registerError"></div>

                    <button type="submit" class="btn btn-success btn-lg w-100 auth-btn">
                        <i class="fas fa-user-plus me-2"></i>Tạo tài khoản
                    </button>

                    <div class="auth-footer mt-3">
                        <p class="text-center">
                            Đã có tài khoản? 
                            <a href="#" class="auth-link" onclick="switchToLogin()">Đăng nhập tại đây</a>
                        </p>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Footer Section -->
<footer class="cinema-footer">
    <div class="footer-container">
        <div class="footer-top">
            <div class="footer-logo">
                <div class="footer-brand-content">
                    <div class="footer-brand-header">
                        <span class="footer-brand-name">Cinema City</span>
                        <div class="footer-brand-logo"></div>
                    </div>
                    <div class="footer-brand-subtitle">Rạp chiếu phim hiện đại</div>
                </div>
            </div>
            <div class="footer-links">
                <div class="footer-column">
                    <h4>Về Chúng Tôi</h4>
                    <ul>
                        <li><a href="#">Giới thiệu</a></li>
                        <li><a href="#">Điều khoản sử dụng</a></li>
                        <li><a href="#">Chính sách bảo mật</a></li>
                        <li><a href="#">Hỗ trợ</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h4>Phim & Sự Kiện</h4>
                    <ul>
                        <li><a href="#">Phim đang chiếu</a></li>
                        <li><a href="#">Phim sắp chiếu</a></li>
                        <li><a href="#">Lịch chiếu</a></li>
                        <li><a href="#">Khuyến mãi</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h4>Rạp Cinema City</h4>
                    <ul>
                        <li><a href="#">Hệ thống rạp</a></li>
                        <li><a href="#">Tuyển dụng</a></li>
                        <li><a href="#">Liên hệ quảng cáo</a></li>
                        <li><a href="#">FAQs</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="footer-middle">
            <div class="contact-info">
                <h4>Kết nối với chúng tôi</h4>
                <div class="social-icons">
                    <a href="#" class="social-icon"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" class="social-icon"><i class="fab fa-twitter"></i></a>
                    <a href="#" class="social-icon"><i class="fab fa-instagram"></i></a>
                    <a href="#" class="social-icon"><i class="fab fa-youtube"></i></a>
                </div>
            </div>
            <div class="app-download">
                <h4>Tải ứng dụng</h4>
                <div class="app-buttons">
                    <a href="#" class="app-button">
                        <i class="fab fa-apple"></i>
                        <span>App Store</span>
                    </a>
                    <a href="#" class="app-button">
                        <i class="fab fa-google-play"></i>
                        <span>Google Play</span>
                    </a>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; @DateTime.Now.Year Cinema City. Tất cả quyền được bảo lưu.</p>
        </div>
    </div>
</footer>

@section Scripts {
    <script>
        // Truyền dữ liệu phim từ server sang JavaScript
        window.heroMovies = @Html.Raw(Json.Serialize(Model?.HeroMovies?.Select(m => new {
            id = m.Id,
            title = m.Title,
            titleVn = m.ProductionCompany ?? "Nhà sản xuất",
            plot = m.Content ?? "Chưa có thông tin nội dung.",
            genre = m.Genres != null && m.Genres.Any() ? string.Join(", ", m.Genres) : "Chưa phân loại",
            duration = m.RunningTime > 0 ? $"{m.RunningTime} phút" : "Chưa có thông tin",
            background = m.PrimaryImageUrl ?? (m.Images != null && m.Images.Any() ? m.Images.FirstOrDefault(img => img.IsPrimary)?.ImageUrl ?? m.Images.First().ImageUrl : "https://via.placeholder.com/1920x1080/1a1a1a/ffffff?text=No+Image")
        }) ?? new[] { new {
            id = "",
            title = "Oppenheimer 2023",
            titleVn = "Cha đẻ bom nguyên tử",
            plot = "Phim Oppenheimer kể về cuộc đời của J. Robert Oppenheimer, nhà vật lý lý thuyết người Mỹ được mệnh danh là 'cha đẻ của bom nguyên tử' vì vai trò của ông trong Dự án Manhattan.",
            genre = "Lịch sử, Tiểu sử, Chính kịch",
            duration = "3 Giờ",
            background = "https://image.tmdb.org/t/p/original/8Gxv8gSFCU0XGDykEGv7zR1n2ua.jpg"
        }}));
        
        window.movieUrls = {
            moviesIndex: '@Url.Action("Index", "Movies")',
            movieDetails: '@Url.Action("Details", "Movies")'
        };
        
        // Auth Modal Functions
        function switchToLogin() {
            $('#registerModal').modal('hide');
            setTimeout(() => {
                $('#loginModal').modal('show');
            }, 300);
        }
        
        function switchToRegister() {
            $('#loginModal').modal('hide');
            setTimeout(() => {
                $('#registerModal').modal('show');
            }, 300);
        }
        
        // Toggle password visibility
        document.querySelectorAll('.toggle-password').forEach(button => {
            button.addEventListener('click', function() {
                const input = this.parentElement.querySelector('input');
                const icon = this.querySelector('i');
                
                if (input.type === 'password') {
                    input.type = 'text';
                    icon.classList.remove('fa-eye');
                    icon.classList.add('fa-eye-slash');
                } else {
                    input.type = 'password';
                    icon.classList.remove('fa-eye-slash');
                    icon.classList.add('fa-eye');
                }
            });
        });
        
        // Login form submission
        document.getElementById('loginForm')?.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            
            // Clear previous errors
            document.getElementById('loginError').textContent = '';
            
            // Basic validation
            if (!formData.get('username') || !formData.get('password')) {
                document.getElementById('loginError').textContent = 'Vui lòng nhập đầy đủ thông tin';
                return;
            }
            
            try {
                // Prepare form data for model binding
                const formBody = new URLSearchParams();
                formBody.append('Username', formData.get('username'));
                formBody.append('Password', formData.get('password'));
                formBody.append('RememberMe', 'false');
                
                const response = await fetch('@Url.Action("Login", "Account")', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
                    },
                    body: formBody.toString()
                });
                
                // Check if response is JSON
                const contentType = response.headers.get("content-type");
                if (contentType && contentType.indexOf("application/json") !== -1) {
                    const result = await response.json();
                    
                    if (result.success) {
                        // Reload page after successful login
                        window.location.reload();
                    } else {
                        document.getElementById('loginError').textContent = result.message || 'Đăng nhập thất bại';
                    }
                } else {
                    // If not JSON, it might be a redirect or HTML response
                    if (response.ok || response.redirected) {
                        window.location.reload();
                    } else {
                        document.getElementById('loginError').textContent = 'Có lỗi xảy ra, vui lòng thử lại';
                    }
                }
            } catch (error) {
                console.error('Login error:', error);
                document.getElementById('loginError').textContent = 'Có lỗi xảy ra, vui lòng thử lại';
            }
        });
        
        // Register form submission
        document.getElementById('registerForm')?.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            
            // Clear previous errors
            document.getElementById('registerError').textContent = '';
            
            // Basic validation
            if (!formData.get('username') || !formData.get('email') || !formData.get('password') || 
                !formData.get('confirmPassword') || !formData.get('fullName')) {
                document.getElementById('registerError').textContent = 'Vui lòng nhập đầy đủ thông tin bắt buộc';
                return;
            }
            
            if (formData.get('password') !== formData.get('confirmPassword')) {
                document.getElementById('registerError').textContent = 'Mật khẩu xác nhận không khớp';
                return;
            }
            
            try {
                // Prepare form data for model binding
                const formBody = new URLSearchParams();
                formBody.append('Username', formData.get('username'));
                formBody.append('Email', formData.get('email'));
                formBody.append('Password', formData.get('password'));
                formBody.append('ConfirmPassword', formData.get('confirmPassword'));
                formBody.append('FullName', formData.get('fullName'));
                formBody.append('Phone', formData.get('phone') || '');
                formBody.append('IdentityCard', formData.get('identityCard') || '');
                formBody.append('Address', formData.get('address') || '');
                formBody.append('BirthDate', formData.get('birthDate') || '');
                formBody.append('Gender', formData.get('gender') || '');
                
                const response = await fetch('@Url.Action("Register", "Account")', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        'RequestVerificationToken': document.querySelector('#registerForm input[name="__RequestVerificationToken"]').value
                    },
                    body: formBody.toString()
                });
                
                // Check if response is JSON
                const contentType = response.headers.get("content-type");
                if (contentType && contentType.indexOf("application/json") !== -1) {
                    const result = await response.json();
                    
                    if (result.success) {
                        // Switch to login modal
                        switchToLogin();
                        // Show success message
                        document.getElementById('loginError').innerHTML = '<div class="alert alert-success">Đăng ký thành công! Vui lòng đăng nhập.</div>';
                    } else {
                        document.getElementById('registerError').textContent = result.message || 'Đăng ký thất bại';
                    }
                } else {
                    // If not JSON, check if it's a redirect
                    if (response.ok || response.redirected) {
                        switchToLogin();
                        document.getElementById('loginError').innerHTML = '<div class="alert alert-success">Đăng ký thành công! Vui lòng đăng nhập.</div>';
                    } else {
                        document.getElementById('registerError').textContent = 'Có lỗi xảy ra, vui lòng thử lại';
                    }
                }
            } catch (error) {
                console.error('Register error:', error);
                document.getElementById('registerError').textContent = 'Có lỗi xảy ra, vui lòng thử lại';
            }
        });
    </script>
    <script src="~/js/homepage.js"></script>
}